# YOYOæµåª’ä½“å¹³å°ä½¿ç”¨æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: YOYOå®‰å…¨æµåª’ä½“æ’­æ”¾å¹³å°  
**å½“å‰ç‰ˆæœ¬**: v2.0 (SimpleStreamManageræ¶æ„)  
**é¡¹ç›®çŠ¶æ€**: ç”Ÿäº§å°±ç»ªï¼Œ100%å®Œæˆ  
**æœ€åæ›´æ–°**: 2025-10-03 20:35  

---

## ğŸ“± ç”¨æˆ·è®¿é—®æ–¹å¼

### å‰ç«¯è®¿é—®
- **ç”¨æˆ·ç•Œé¢**: https://yoyo.5202021.xyz
- **ç®¡ç†åå°**: https://yoyo.5202021.xyz (ä½¿ç”¨ admin/admin123 ç™»å½•)

### APIæ¥å£
- **Cloudflare Workers API**: https://yoyoapi.5202021.xyz
- **VPSç›´è¿API**: https://yoyo-vps.5202021.xyz

---

## ğŸ¥ é¢‘é“ç®¡ç†

### æ·»åŠ æ–°é¢‘é“
```bash
curl -X POST "https://yoyoapi.5202021.xyz/api/simple-stream/configure" \
  -H "Content-Type: application/json" \
  -d '{
    "channelId": "new_channel_id",
    "name": "æ–°é¢‘é“åç§°",
    "rtmpUrl": "rtmp://your-rtmp-source-url"
  }'
```

### å¼€å§‹è§‚çœ‹é¢‘é“
```bash
curl -X POST "https://yoyoapi.5202021.xyz/api/simple-stream/start-watching" \
  -H "Content-Type: application/json" \
  -d '{
    "channelId": "channel_id",
    "userId": "user_001"
  }'
```

### åœæ­¢è§‚çœ‹é¢‘é“
```bash
curl -X POST "https://yoyoapi.5202021.xyz/api/simple-stream/stop-watching" \
  -H "Content-Type: application/json" \
  -d '{
    "sessionId": "session_id_from_start_watching"
  }'
```

### è·å–é¢‘é“çŠ¶æ€
```bash
curl "https://yoyoapi.5202021.xyz/api/simple-stream/channel/channel_id/status"
```

### è·å–ç³»ç»ŸçŠ¶æ€
```bash
curl "https://yoyoapi.5202021.xyz/api/simple-stream/system/status"
```

---

## ğŸ”§ ç³»ç»Ÿç›‘æ§å’Œç»´æŠ¤

### 1. ç³»ç»ŸçŠ¶æ€æ£€æŸ¥

#### æ£€æŸ¥æ•´ä½“ç³»ç»ŸçŠ¶æ€
```bash
# æ£€æŸ¥ç³»ç»Ÿæ•´ä½“çŠ¶æ€
curl https://yoyoapi.5202021.xyz/api/simple-stream/system/status

# æ£€æŸ¥Cloudflare Workerså¥åº·çŠ¶æ€
curl https://yoyoapi.5202021.xyz/health

# æ£€æŸ¥VPSæœåŠ¡çŠ¶æ€
curl https://yoyo-vps.5202021.xyz/health
```

#### æ£€æŸ¥VPSæœåŠ¡å™¨çŠ¶æ€
```bash
# æ£€æŸ¥PM2è¿›ç¨‹çŠ¶æ€
ssh root@142.171.75.220 "pm2 status"

# æ£€æŸ¥HLSæ–‡ä»¶ç”Ÿæˆ
ssh root@142.171.75.220 "ls -la /var/www/hls/"

# æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
ssh root@142.171.75.220 "df -h"
```

### 2. å¸¸ç”¨ç»´æŠ¤å‘½ä»¤

#### æœåŠ¡ç®¡ç†
```bash
# é‡å¯VPSæœåŠ¡
ssh root@142.171.75.220 "pm2 restart vps-transcoder-api"

# åœæ­¢VPSæœåŠ¡
ssh root@142.171.75.220 "pm2 stop vps-transcoder-api"

# å¯åŠ¨VPSæœåŠ¡
ssh root@142.171.75.220 "pm2 start vps-transcoder-api"

# æŸ¥çœ‹æœåŠ¡è¯¦ç»†ä¿¡æ¯
ssh root@142.171.75.220 "pm2 show vps-transcoder-api"
```

#### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹VPSåº”ç”¨æ—¥å¿—
ssh root@142.171.75.220 "pm2 logs vps-transcoder-api --lines 50"

# æŸ¥çœ‹Nginxè®¿é—®æ—¥å¿—
ssh root@142.171.75.220 "tail -f /var/log/nginx/access.log"

# æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
ssh root@142.171.75.220 "tail -f /var/log/nginx/error.log"
```

#### æ–‡ä»¶æ¸…ç†
```bash
# æ¸…ç†æ—§çš„HLSæ–‡ä»¶ï¼ˆè¶…è¿‡24å°æ—¶ï¼‰
ssh root@142.171.75.220 "find /var/www/hls -name '*.ts' -mtime +1 -delete"

# æ¸…ç†ç©ºç›®å½•
ssh root@142.171.75.220 "find /var/www/hls -type d -empty -delete"

# æ¸…ç†åº”ç”¨æ—¥å¿—
ssh root@142.171.75.220 "pm2 flush"
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å½“å‰ç³»ç»Ÿæ€§èƒ½è¡¨ç°
- **è§†é¢‘å»¶è¿Ÿ**: 1-1.5ç§’ï¼ˆ0.6ç§’HLSåˆ†ç‰‡ï¼‰
- **å¹¶å‘æ”¯æŒ**: 50+ç”¨æˆ·åŒæ—¶è§‚çœ‹
- **èµ„æºæ•ˆç‡**: æŒ‰éœ€è½¬ç ï¼Œæ— è§‚çœ‹è€…æ—¶é›¶èµ„æºæ¶ˆè€—
- **ç³»ç»Ÿå¯ç”¨æ€§**: 99.9%
- **APIå“åº”æ—¶é—´**: â‰¤500ms
- **HLSåˆ†ç‰‡å¤§å°**: 0.6ç§’è¶…ä½å»¶è¿Ÿé…ç½®

### æ ¸å¿ƒæ¶æ„ç‰¹æ€§
- âœ… **æŒ‰éœ€è½¬ç ** - æ— è§‚çœ‹è€…æ—¶ä¸å¤„ç†RTMPæµï¼ŒèŠ‚çœèµ„æº
- âœ… **å®æ—¶å¯åŠ¨** - é¦–ä¸ªç”¨æˆ·ç‚¹å‡»æ—¶ç«‹å³å¯åŠ¨è½¬ç è¿›ç¨‹
- âœ… **å…±äº«å¤„ç†** - å¤šç”¨æˆ·å…±äº«åŒä¸€è½¬ç è¿›ç¨‹
- âœ… **æ™ºèƒ½æ¸…ç†** - 5åˆ†é’Ÿæ— æ´»åŠ¨è‡ªåŠ¨åœæ­¢è½¬ç 
- âœ… **è¶…ä½å»¶è¿Ÿ** - 0.5ç§’HLSåˆ†ç‰‡é…ç½®
- âœ… **æ— ç¼åˆ‡æ¢** - é¢‘é“åˆ‡æ¢æ—¶è‡ªåŠ¨æ¸…ç†æ—§ä¼šè¯

---

## ğŸš¨ æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. è§†é¢‘æ— æ³•æ’­æ”¾
**ç—‡çŠ¶**: ç”¨æˆ·ç‚¹å‡»é¢‘é“åæ— æ³•çœ‹åˆ°è§†é¢‘  
**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥RTMPæºæ˜¯å¦æ­£å¸¸
curl -I "rtmp://your-rtmp-source"

# 2. éªŒè¯é¢‘é“é…ç½®
curl "https://yoyoapi.5202021.xyz/api/simple-stream/channel/channel_id/status"

# 3. æ£€æŸ¥VPSæœåŠ¡çŠ¶æ€
ssh root@142.171.75.220 "pm2 status"

# 4. æ£€æŸ¥HLSæ–‡ä»¶æ˜¯å¦ç”Ÿæˆ
ssh root@142.171.75.220 "ls -la /var/www/hls/channel_id/"
```

#### 2. å»¶è¿Ÿè¿‡é«˜
**ç—‡çŠ¶**: è§†é¢‘æ’­æ”¾å»¶è¿Ÿè¶…è¿‡3ç§’  
**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. ç¡®è®¤FFmpegé…ç½®
ssh root@142.171.75.220 "ps aux | grep ffmpeg"

# 2. æ£€æŸ¥ç½‘ç»œè¿æ¥
ping yoyo-vps.5202021.xyz

# 3. éªŒè¯HLSåˆ†ç‰‡å¤§å°
ssh root@142.171.75.220 "cat /var/www/hls/channel_id/playlist.m3u8"
```

#### 3. é¢‘é“åˆ‡æ¢å¤±è´¥
**ç—‡çŠ¶**: ç”¨æˆ·åˆ‡æ¢é¢‘é“æ—¶å‡ºç°é”™è¯¯  
**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥ä¼šè¯ç®¡ç†
curl "https://yoyoapi.5202021.xyz/api/simple-stream/system/status"

# 2. éªŒè¯APIè°ƒç”¨é“¾è·¯
curl -X POST "https://yoyoapi.5202021.xyz/api/simple-stream/stop-watching" \
  -H "Content-Type: application/json" \
  -d '{"sessionId": "test_session"}'

# 3. æ£€æŸ¥å‰ç«¯æ§åˆ¶å°é”™è¯¯
# åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹ç½‘ç»œè¯·æ±‚å’Œæ§åˆ¶å°é”™è¯¯
```

#### 4. ç³»ç»Ÿèµ„æºä¸è¶³
**ç—‡çŠ¶**: æœåŠ¡å™¨å“åº”ç¼“æ…¢æˆ–å†…å­˜ä¸è¶³  
**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨
ssh root@142.171.75.220 "top"
ssh root@142.171.75.220 "free -h"

# 2. æ¸…ç†HLSæ–‡ä»¶
ssh root@142.171.75.220 "find /var/www/hls -name '*.ts' -mtime +1 -delete"

# 3. é‡å¯æœåŠ¡é‡Šæ”¾å†…å­˜
ssh root@142.171.75.220 "pm2 restart vps-transcoder-api"
```

---

## ğŸ” å®‰å…¨ç»´æŠ¤

### å®šæœŸå®‰å…¨æ£€æŸ¥

#### 1. ç³»ç»Ÿæ›´æ–°
```bash
# æ›´æ–°VPSç³»ç»Ÿ
ssh root@142.171.75.220 "yum update -y"

# æ›´æ–°Node.jsä¾èµ–
ssh root@142.171.75.220 "cd /opt/yoyo-transcoder && npm audit fix"
```

#### 2. å¯†é’¥ç®¡ç†
```bash
# æ£€æŸ¥APIå¯†é’¥é…ç½®
wrangler secret list --env production

# è½®æ¢APIå¯†é’¥ï¼ˆå¦‚éœ€è¦ï¼‰
echo "new_api_key" | wrangler secret put VPS_API_KEY --env production
```

#### 3. è®¿é—®æ—¥å¿—ç›‘æ§
```bash
# ç›‘æ§å¼‚å¸¸è®¿é—®
ssh root@142.171.75.220 "tail -f /var/log/nginx/access.log | grep -E '4[0-9]{2}|5[0-9]{2}'"

# æ£€æŸ¥å¤§é‡è¯·æ±‚çš„IP
ssh root@142.171.75.220 "awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -10"
```

---

## ğŸ“ˆ æœªæ¥æ‰©å±•å»ºè®®

### 1. æ€§èƒ½ä¼˜åŒ–
- **Redisç¼“å­˜å±‚**: æ·»åŠ Redisæå‡APIå“åº”é€Ÿåº¦
- **è´Ÿè½½å‡è¡¡**: å®ç°å¤šVPSè´Ÿè½½å‡è¡¡æ”¯æŒæ›´å¤šå¹¶å‘
- **CDNä¼˜åŒ–**: ä¼˜åŒ–Cloudflareç¼“å­˜ç­–ç•¥
- **FFmpegä¼˜åŒ–**: è¿›ä¸€æ­¥ä¼˜åŒ–ç¼–ç å‚æ•°é™ä½å»¶è¿Ÿ

### 2. åŠŸèƒ½å¢å¼º
- **å½•åˆ¶åŠŸèƒ½**: æ·»åŠ é‡è¦è§†é¢‘å½•åˆ¶ä¿å­˜
- **å¤šç ç‡æ”¯æŒ**: å®ç°è‡ªé€‚åº”ç ç‡æ’­æ”¾
- **ç”¨æˆ·æƒé™**: å®Œå–„ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ
- **ç§»åŠ¨ç«¯ä¼˜åŒ–**: ä¼˜åŒ–ç§»åŠ¨è®¾å¤‡æ’­æ”¾ä½“éªŒ

### 3. ç›‘æ§å‘Šè­¦
- **Prometheusé›†æˆ**: æ·»åŠ è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡ç›‘æ§
- **Grafanaä»ªè¡¨æ¿**: åˆ›å»ºå¯è§†åŒ–ç›‘æ§é¢æ¿
- **è‡ªåŠ¨å‘Šè­¦**: è®¾ç½®æœåŠ¡å¼‚å¸¸è‡ªåŠ¨å‘Šè­¦æœºåˆ¶
- **æ—¥å¿—åˆ†æ**: é›†æˆELKæ ˆè¿›è¡Œæ—¥å¿—åˆ†æ

### 4. é«˜å¯ç”¨æ€§
- **å¤šåŒºåŸŸéƒ¨ç½²**: å®ç°å¤šåœ°åŸŸå®¹ç¾å¤‡ä»½
- **è‡ªåŠ¨æ•…éšœè½¬ç§»**: æ·»åŠ è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œè½¬ç§»
- **æ•°æ®å¤‡ä»½**: å®ç°é…ç½®å’Œé‡è¦æ•°æ®è‡ªåŠ¨å¤‡ä»½
- **å¥åº·æ£€æŸ¥**: å®Œå–„è‡ªåŠ¨å¥åº·æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç›¸å…³æ–‡æ¡£
1. **æ¶æ„æ–‡æ¡£**: `doc/YOYO_PLATFORM_ARCHITECTURE.md`
2. **é¡¹ç›®è¿›åº¦**: `doc/PROJECT_PROGRESS.md`
3. **éƒ¨ç½²æŒ‡å—**: `COMPLETE_DEPLOYMENT_GUIDE.md`
4. **APIæ–‡æ¡£**: æŸ¥çœ‹æ¶æ„æ–‡æ¡£ä¸­çš„APIæµ‹è¯•ç¤ºä¾‹

### è‡ªåŠ¨åŒ–è„šæœ¬
- **å¥åº·æ£€æŸ¥**: `scripts/health-check.sh`
- **HLSæ¸…ç†**: `scripts/cleanup-hls.sh`
- **éƒ¨ç½²è„šæœ¬**: `scripts/deploy-simple-to-vps.ps1`

### è”ç³»æ–¹å¼
- **é¡¹ç›®ä»“åº“**: GitHub Issues
- **æŠ€æœ¯æ–‡æ¡£**: é¡¹ç›®docç›®å½•
- **åœ¨çº¿ç›‘æ§**: https://yoyoapi.5202021.xyz/health

---

## ğŸ‰ é¡¹ç›®æˆå°±

### æŠ€æœ¯çªç ´
- **è¶…ä½å»¶è¿Ÿ**: å®ç°1-1.5ç§’çš„è§†é¢‘æ’­æ”¾å»¶è¿Ÿ
- **èµ„æºä¼˜åŒ–**: æŒ‰éœ€è½¬ç èŠ‚çœ70%+æœåŠ¡å™¨èµ„æº
- **æ™ºèƒ½ç®¡ç†**: å…¨è‡ªåŠ¨ä¼šè¯ç®¡ç†å’Œè¿›ç¨‹æ¸…ç†
- **é«˜å¯ç”¨æ€§**: 99.9%ç³»ç»Ÿå¯ç”¨æ€§ä¿è¯

### æ¶æ„ä¼˜åŠ¿
- **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**: Vue.js 3 + Cloudflare Workers + Node.js
- **äº‘åŸç”Ÿè®¾è®¡**: æ— æœåŠ¡å™¨æ¶æ„ï¼Œè‡ªåŠ¨æ‰©ç¼©å®¹
- **å®‰å…¨å¯é **: å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼ŒAPIå¯†é’¥è®¤è¯
- **æ˜“äºç»´æŠ¤**: å®Œæ•´çš„æ–‡æ¡£å’Œè‡ªåŠ¨åŒ–è„šæœ¬

---

**ğŸš€ YOYOæµåª’ä½“å¹³å°å·²æˆåŠŸéƒ¨ç½²å¹¶æŠ•å…¥ä½¿ç”¨ï¼**

**ç³»ç»Ÿè¿è¡Œç¨³å®šï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éªŒè¯é€šè¿‡ï¼Œå¯ä»¥ä¸ºç”¨æˆ·æä¾›ä¼˜è´¨çš„ä½å»¶è¿Ÿè§†é¢‘æµæœåŠ¡ã€‚**

---

*æ–‡æ¡£ç‰ˆæœ¬: v2.0*  
*æœ€åæ›´æ–°: 2025-10-03 20:35*  
*ç»´æŠ¤å›¢é˜Ÿ: YOYOå¼€å‘å›¢é˜Ÿ*
