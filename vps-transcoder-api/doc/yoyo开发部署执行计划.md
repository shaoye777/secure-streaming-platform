---

### **项目开发部署执行计划**

项目名称: 多用户、多频道安全流媒体Web播放平台  
版本: 1.0  
日期: 2025年9月18日

---

#### **阶段一：基础设施搭建与环境准备 (预计：1-2天)**

此阶段的目标是建立项目运行所需的基础环境，确保后续开发工作可以顺利进行。

* **任务 1.1: 采购并初始化VPS服务器**  
  * **负责人:** 运维/后端工程师  
  * **描述:** 采购一台符合配置的云服务器 (VPS)，并完成基础的操作系统安装 (推荐 Ubuntu 22.04 LTS)。  
  * **验收标准:** 可以通过SSH成功登录VPS。  
* **任务 1.2: 安装核心依赖软件**  
  * **负责人:** 运维/后端工程师  
  * **描述:** 在VPS上安装并验证所有必需的软件：Nginx、Node.js、NPM、FFmpeg。  
  * **验收标准:** 在服务器命令行中执行 nginx \-v, node \-v, npm \-v, ffmpeg \-v 均能成功返回版本号。  
* **任务 1.3: 配置Cloudflare环境**  
  * **负责人:** 前端/全栈工程师  
  * **描述:**  
    * 注册并配置好项目的Cloudflare账户。  
    * 创建KV命名空间，命名为 USER\_SESSIONS。  
    * 初始化本地开发环境，安装 wrangler CLI工具。  
  * **验收标准:** wrangler whoami 命令可以成功显示账户信息。  
* **任务 1.4: 初始化代码仓库**  
  * **负责人:** 项目负责人  
  * **描述:** 创建Git代码仓库，建立两个主要的子目录：vps-transcoder-api 和 cloudflare-worker，并完成初始提交。  
  * **验收标准:** 团队成员可以克隆代码仓库。

---

#### **阶段二：后端核心服务开发 (预计：3-4天)**

此阶段专注于开发VPS上的转码API服务，这是整个系统的引擎。

* **任务 2.1: 开发基础API服务器**  
  * **负责人:** 后端工程师  
  * **描述:** 使用Node.js和Express.js搭建一个基础的Web服务器，监听3000端口。实现基于 X-API-Key 的安全认证中间件。  
  * **验收标准:** 可以通过发送带正确密钥的请求访问API，无密钥的请求返回403 Forbidden。  
* **任务 2.2: 实现FFmpeg进程管理逻辑**  
  * **负责人:** 后端工程师  
  * **描述:** 编写核心的进程管理代码，使用child\_process.spawn来启动FFmpeg进程，并通过Map对象进行追踪管理。  
  * **验收标准:** 内部函数可以成功启动和终止一个FFmpeg进程。  
* **任务 2.3: 开发 /start-stream API端点**  
  * **负责人:** 后端工程师  
  * **描述:** 完成 POST /start-stream 接口的开发，使其能够接收streamId和rtmpUrl，并调用进程管理逻辑来启动转码。  
  * **验收标准:** 通过API请求，可以成功启动一个FFmpeg进程，并在指定的目录 (/var/www/hls/{streamId}/)下看到生成的HLS文件。  
* **任务 2.4: 配置Nginx和PM2**  
  * **负责人:** 后端/运维工程师  
  * **描述:**  
    * 配置Nginx作为Web服务器，用于托管/var/www/hls目录。  
    * 安装pm2，并配置启动脚本来守护Node.js API服务的运行。  
  * **验收标准:** Node.js服务可以在后台稳定运行，并且可以通过 http://\<VPS\_IP\>:8080/{streamId}/stream.m3u8 访问到HLS文件。

---

#### **阶段三：Cloudflare Worker与前端开发 (预计：5-7天)**

此阶段并行开发前端界面和Worker的业务逻辑。

* **任务 3.1: KV数据模型与用户创建**  
  * **负责人:** 全栈/前端工程师  
  * **描述:** 编写一个本地辅助脚本，用于生成加盐哈希后的密码，并手动在Cloudflare KV中创建第一个管理员用户和streams\_config的初始数据。  
  * **验收标准:** KV中已存在可用于测试的管理员账户和频道配置。  
* **任务 3.2: 开发用户认证与会话逻辑 (Worker)**  
  * **负责人:** 全栈/前端工程师  
  * **描述:** 在Worker中实现登录(POST /login)、登出(POST /logout)和会话验证逻辑。成功登录后，能够正确设置安全的HttpOnly Cookie。  
  * **验收标准:** 用户可以通过登录接口获取会话Cookie，所有受保护的路由会正确拦截未授权的访问。  
* **任务 3.3: 开发前端基础页面与路由 (Vue/React)**  
  * **负责人:** 前端工程师  
  * **描述:** 创建前端项目，并搭建基础的页面组件，包括Login.vue, Dashboard.vue, VideoPlayer.vue等。配置前端路由。  
  * **验收标准:** 用户可以访问登录页面，登录成功后能跳转到空白的仪表板页面。  
* **任务 3.4: 开发管理员频道管理功能**  
  * **负责人:** 全栈/前端工程师  
  * **描述:**  
    * **Worker:** 实现GET/POST/DELETE /api/admin/streams等系列API，用于读写KV中的streams\_config。  
    * **前端:** 开发StreamManager.vue组件，提供增删改查频道的用户界面。  
  * **验收标准:** 管理员登录后，可以成功地通过Web界面添加和删除频道配置。  
* **任务 3.5: 开发用户观看流程**  
  * **负责人:** 全栈/前端工程师  
  * **描述:**  
    * **Worker:** 实现GET /api/streams（获取频道列表）和POST /api/play/:id（请求播放）接口。play接口需要能正确调用VPS的转码API。  
    * **前端:** 开发StreamList.vue组件展示频道列表。当用户点击播放时，前端调用play接口并接收返回的hlsUrl，然后传递给VideoPlayer.vue组件进行播放。  
  * **验收标准:** 普通用户登录后，可以看到频道列表，点击后视频播放器能成功加载并播放视频。

---

#### **阶段四：集成、测试与部署 (预计：2-3天)**

此阶段将所有部分整合在一起，进行端到端的测试和最终部署。

* **任务 4.1: 端到端集成测试**  
  * **负责人:** 测试/全体开发  
  * **描述:** 模拟完整用户流程进行测试：管理员登录并配置频道 \-\> 普通用户登录 \-\> 选择并观看频道 \-\> 切换频道 \-\> 登出。  
  * **验收标准:** 所有功能符合需求文档描述，流程顺畅无误。  
* **任务 4.2: 安全加固与配置**  
  * **负责人:** 运维/项目负责人  
  * **描述:**  
    * 在Cloudflare Worker中将VPS的IP和API密钥配置为Secrets。  
    * 配置Cloudflare防火墙规则，仅允许Cloudflare IP访问VPS的Web端口，实现源站保护。  
    * 确保所有面向用户的流量强制使用HTTPS。  
  * **验收标准:** 安全配置完成，无法通过IP直接访问VPS。  
* **任务 4.3: 最终部署**  
  * **负责人:** 项目负责人  
  * **描述:**  
    * 将VPS上的pm2服务配置为开机自启。  
    * 使用wrangler deploy将最终版本的Worker脚本部署到生产环境。  
  * **验收标准:** 项目成功上线，可通过公开域名访问。  
* **任务 4.4: 编写文档和交接**  
  * **负责人:** 项目负责人  
  * **描述:** 编写简单的用户手册（如何添加管理员和频道）和运维手册（如何启动/重启服务）。  
  * **验收标准:** 相关文档交付完成。