好的，非常乐意为您将我们讨论的所有细节，整理成一份清晰、完整的需求文档。

这份文档可以作为您项目开发的蓝图和指导。

---

### **需求规格说明书 (Requirements Specification Document)**

项目名称: 多用户、多频道安全流媒体Web播放平台  
版本: 1.0  
日期: 2025年9月18日

---

#### **1\. 项目概述**

##### **1.1. 项目目标**

本项目旨在构建一个私有的、基于Web的安全流媒体播放平台。该平台允许注册用户通过浏览器方便地观看多个实时RTMP视频流。系统的核心特性是按需处理视频流、支持多用户权限管理，并利用现代云架构实现高效、安全、可扩展的视频分发。

##### **1.2. 项目范围**

本项目范围包括用户认证、管理员后台、频道管理、视频流按需转换以及Web端播放器的全部功能。不包括用户自行注册、密码找回、视频录制与回放等高级功能。

##### **1.3. 目标用户**

* **管理员 (Administrator):** 负责配置和维护平台的系统管理员。  
* **普通用户 (User):** 经过授权，需要登录才能观看指定视频流的终端用户。

---

#### **2\. 总体架构**

本平台采用职责分离的现代化架构，由两部分核心服务组成：

* **转码服务 (部署于VPS):** 一个专用的后端服务，作为“执行层”，仅负责接收指令并执行计算密集型的视频流转码任务。  
* **业务与Web服务 (部署于Cloudflare):** 作为“决策与表示层”，基于Cloudflare Workers和KV实现所有业务逻辑、用户认证、API编排和前端页面展示，并利用Cloudflare的CDN网络进行内容分发。

---

#### **3\. 功能性需求**

##### **3.1. 用户认证与权限模块**

* **FR-1: 安全登录:** 系统必须提供一个登录页面。用户需凭用户名和密码进行身份验证。  
* **FR-2: 角色区分:** 系统需内置两种用户角色：管理员和普通用户，不同角色拥有不同权限。  
* **FR-3: 会话管理:** 用户成功登录后，系统应建立一个会话（Session），后续所有请求需验证会话有效性。  
* **FR-4: 访问控制:** 除登录页面外，所有页面和API接口都必须受到保护，仅限已登录用户访问。  
* **FR-5: 安全登出:** 用户可以主动登出，清除其登录会话。

##### **3.2. 管理员功能模块**

* **FR-6: 管理员识别:** 系统必须能够识别登录用户是否为管理员，并仅为管理员展示管理功能入口。  
* **FR-7: 频道管理:** 管理员应拥有一个专用的管理界面，可以对视频流频道进行完整的CRUD（创建、读取、更新、删除）操作。  
  * **FR-7.1 (创建):** 管理员可以添加新的频道，需提供“频道名称”（对用户可见，如“前门监控”）和该频道对应的原始“RTMP流地址”。  
  * **FR-7.2 (读取):** 管理员可以查看一个包含所有已配置频道的列表。  
  * **FR-7.3 (更新/删除):** 管理员可以编辑或删除已存在的频道。

##### **3.3. 普通用户观看模块**

* **FR-8: 频道列表展示:** 普通用户登录后，主界面应展示一个清晰的、可供选择的频道列表，该列表只显示管理员设置的“频道名称”。  
* **FR-9: 视频按需播放 (On-Demand Playback):**  
  * **FR-9.1 (资源节省):** 当没有任何用户观看某个频道时，系统不应对该频道的RTMP流进行任何处理。  
  * **FR-9.2 (实时启动):** 当有**第一个**用户点击某个频道时，系统应立即启动对该频道源RTMP流的格式转换处理。  
  * **FR-9.3 (共享处理):** 当**多个用户**同时观看**同一个频道**时，系统**只需维持一个**转码进程，所有用户共享该进程的处理结果。  
* **FR-10: Web端流畅播放:** 视频流必须能在主流现代浏览器的播放器中稳定、流畅地播放。  
* **FR-11: 无缝频道切换:** 用户应可以从当前播放的频道，无缝切换到频道列表中的任何其他频道。

---

#### **4\. 非功能性需求**

##### **4.1. 性能**

* **NFR-1 (扩展性):** 系统必须能够高效地服务多个并发用户。用户数量的增长不应线性增加VPS服务器的转码负载。  
* **NFR-2 (响应速度):** 用户登录、页面加载、API响应应快速完成。视频加载的初始延迟应尽可能低。

##### **4.2. 安全**

* **NFR-3 (凭证安全):** 用户密码在数据库中必须经过加盐哈希（Salted Hash）后存储，严禁明文存储。  
* **NFR-4 (源站保护):** VPS服务器的IP地址不应向公网直接暴露，所有流量都应通过Cloudflare进行代理。  
* **NFR-5 (API安全):** Cloudflare Worker与VPS转码服务之间的API通信必须通过密钥等方式进行认证，防止未经授权的调用。  
* **NFR-6 (会话安全):** 用于会话管理的浏览器Cookie应设置为HttpOnly, Secure 和 SameSite=Strict属性。

##### **4.3. 可用性**

* **NFR-7 (界面简洁):** 无论是管理员界面还是用户观看界面，都应设计简洁、直观，易于操作。

---

#### **5\. 技术栈与协议规定**

* **视频协议:**  
  * 输入协议: RTMP  
  * 输出协议: HLS (HTTP Live Streaming)  
* **转码服务 (VPS):**  
  * 核心工具: FFmpeg  
  * API服务: 轻量级Web框架 (如 Node.js/Express, Python/Flask)  
  * Web服务器: Nginx (用于托管HLS文件)  
* **业务与Web服务 (Cloudflare):**  
  * 业务逻辑: Cloudflare Workers  
  * 数据存储: Cloudflare KV