基于PRD.md，我将生成一份详细的开发者TodoList，按照技术实现优先级和依赖关系进行组织：

# **YOYO流媒体平台开发TodoList**

## **📋 项目概览**
- **项目名称**: 多用户、多频道安全流媒体Web播放平台
- **技术栈**: Node.js + Express + FFmpeg + Cloudflare Workers + Vue.js/React + hls.js
- **预计工期**: 11-16天
- **团队角色**: 后端工程师、前端工程师、全栈工程师、运维工程师

---

## **🚀 阶段一：基础设施搭建 (1-2天)**

### **运维/后端工程师任务**
- [ ] **VPS服务器采购和初始化**
  - [ ] 采购符合配置要求的云服务器(已安装Centos9，CPU: 1 Core, RAM: 2GB, Disk: 30GB)
  - [ ] 配置SSH密钥登录
  - [ ] 设置基础防火墙规则
  - [ ] 更新系统包和安全补丁

- [ ] **核心依赖软件安装**
  - [ ] 安装Nginx并配置自启动
  - [ ] 安装Node.js (v18+) 和 NPM
  - [ ] 安装FFmpeg (确保支持RTMP和HLS)
  - [ ] 安装PM2进程管理器
  - [ ] 验证所有软件版本：`nginx -v, node -v, npm -v, ffmpeg -v`

- [ ] **目录结构创建**
  - [ ] 创建`/var/www/hls`目录
  - [ ] 设置正确的目录权限
  - [ ] 创建日志目录`/var/log/transcoder`

### **前端/全栈工程师任务**
- [ ] **Cloudflare环境配置**
  - [ ] 注册Cloudflare账户
  - [ ] 创建KV命名空间 `USER_SESSIONS`
  - [ ] 安装wrangler CLI工具
  - [ ] 验证wrangler身份：`wrangler whoami`
  - [ ] 初始化Worker项目结构

### **项目负责人任务**
- [ ] **代码仓库初始化**
  - [ ] 创建Git仓库
  - [ ] 设置目录结构：
    - [ ] `vps-transcoder-api/` (后端转码服务)
    - [ ] `cloudflare-worker/` (Worker业务逻辑)
    - [ ] `frontend/` (前端应用)
    - [ ] `docs/` (项目文档)
  - [ ] 创建README.md和基础文档
  - [ ] 配置.gitignore文件

---

## **⚙️ 阶段二：后端核心服务开发 (3-4天)**

### **后端工程师任务**

#### **API服务器基础架构**
- [ ] **项目初始化**
  - [ ] 初始化Node.js项目：`npm init -y`
  - [ ] 安装核心依赖：
```shell script
npm install express cors helmet morgan uuid bcrypt
    npm install -D nodemon jest supertest
```

  - [ ] 创建基础目录结构：
```
vps-transcoder-api/
    ├── src/
    │   ├── routes/
    │   ├── middleware/
    │   ├── services/
    │   └── utils/
    ├── tests/
    └── config/
```


- [ ] **安全认证中间件开发**
  - [ ] 实现X-API-Key验证中间件
  - [ ] 配置API密钥环境变量管理
  - [ ] 添加请求日志和错误处理
  - [ ] 实现IP白名单验证(Cloudflare IP段)

#### **FFmpeg进程管理系统**
- [ ] **进程管理核心逻辑**
  - [ ] 创建`ProcessManager`类
  - [ ] 实现进程Map存储：`Map<streamId, Process>`
  - [ ] 开发FFmpeg命令构造器
  - [ ] 实现进程启动逻辑：
```javascript
startTranscode(streamId, rtmpUrl) {
      // 检查是否已存在进程
      // 终止旧进程(如果存在)
      // 创建新的FFmpeg子进程
      // 添加到进程Map
    }
```

  - [ ] 实现进程终止和清理逻辑
  - [ ] 添加进程状态监控和重启机制

- [ ] **FFmpeg转码配置**
  - [ ] 配置RTMP输入参数
  - [ ] 配置HLS输出参数：
    - [ ] segment时长：2秒
    - [ ] playlist窗口大小：6个segment
    - [ ] 视频编码：H.264
    - [ ] 音频编码：AAC
  - [ ] 创建输出目录管理逻辑
  - [ ] 实现转码质量参数配置

#### **REST API端点实现**
- [ ] **POST /start-stream端点**
  - [ ] 实现请求参数验证(streamId, rtmpUrl)
  - [ ] 集成ProcessManager调用
  - [ ] 实现响应格式标准化
  - [ ] 添加错误处理和状态码规范
  - [ ] 编写单元测试

- [ ] **GET /status端点(可选)**
  - [ ] 返回系统运行状态
  - [ ] 显示活跃的转码进程列表
  - [ ] 系统资源使用情况

- [ ] **POST /stop-stream端点(可选)**
  - [ ] 手动停止指定转码进程
  - [ ] 清理相关文件和资源

#### **服务部署配置**
- [ ] **Nginx配置**
  - [ ] 配置静态文件服务：`/var/www/hls`
  - [ ] 设置CORS头支持
  - [ ] 配置缓存策略
  - [ ] 添加访问日志
  - [ ] 配置SSL证书(如需要)

- [ ] **PM2进程守护**
  - [ ] 创建PM2配置文件`ecosystem.config.js`
  - [ ] 配置进程自动重启策略
  - [ ] 设置日志轮转
  - [ ] 配置开机自启动
  - [ ] 编写部署和重启脚本

- [ ] **系统监控和日志**
  - [ ] 实现结构化日志记录
  - [ ] 配置日志级别和输出格式
  - [ ] 添加性能监控埋点
  - [ ] 创建健康检查端点

---

## **🌐 阶段三：Cloudflare Worker与前端开发 (5-7天)**

### **全栈/后端工程师任务**

#### **Cloudflare KV数据模型**
- [ ] **用户数据管理**
  - [ ] 设计用户数据结构：
```javascript
{
      "username": "admin",
      "salt": "randomSalt",
      "hashedPassword": "pbkdf2Hash",
      "role": "admin|user",
      "createdAt": "timestamp"
    }
```

  - [ ] 创建密码哈希工具函数
  - [ ] 实现用户创建脚本
  - [ ] 初始化管理员账户

- [ ] **会话管理系统**
  - [ ] 设计会话数据结构：
```javascript
{
      "sessionId": "uuid-v4",
      "username": "admin",
      "expiresAt": "timestamp",
      "createdAt": "timestamp"
    }
```

  - [ ] 实现会话创建和验证逻辑
  - [ ] 配置KV TTL自动过期
  - [ ] 实现会话清理机制

- [ ] **频道配置管理**
  - [ ] 设计streams_config数据结构：
```javascript
[
      {
        "id": "cam1",
        "name": "大厅摄像头",
        "rtmpUrl": "rtmp://source/live/stream1",
        "createdAt": "timestamp",
        "updatedAt": "timestamp"
      }
    ]
```

  - [ ] 实现CRUD操作函数
  - [ ] 添加数据验证和错误处理

#### **Cloudflare Worker路由和API**
- [ ] **项目初始化**
  - [ ] 初始化wrangler项目：`wrangler init`
  - [ ] 配置wrangler.toml绑定
  - [ ] 设置环境变量和Secrets

- [ ] **认证相关API**
  - [ ] `GET /login` - 登录页面
  - [ ] `POST /login` - 登录处理：
    - [ ] 用户名密码验证
    - [ ] 密码哈希比较
    - [ ] 会话创建和Cookie设置
    - [ ] 错误处理和响应
  - [ ] `POST /logout` - 登出处理：
    - [ ] 会话清理
    - [ ] Cookie删除
    - [ ] 重定向到登录页

- [ ] **用户功能API**
  - [ ] `GET /api/streams` - 获取频道列表：
    - [ ] 会话验证
    - [ ] 从KV读取streams_config
    - [ ] 返回格式化数据
  - [ ] `POST /api/play/:id` - 请求播放：
    - [ ] 会话和权限验证
    - [ ] 频道配置查询
    - [ ] 调用VPS转码API
    - [ ] 返回HLS播放地址

- [ ] **管理员功能API**
  - [ ] `GET /api/admin/streams` - 获取所有频道
  - [ ] `POST /api/admin/streams` - 添加频道：
    - [ ] 管理员权限验证
    - [ ] 数据验证(名称、RTMP URL)
    - [ ] 生成唯一ID
    - [ ] 更新KV存储
  - [ ] `PUT /api/admin/streams/:id` - 更新频道
  - [ ] `DELETE /api/admin/streams/:id` - 删除频道

- [ ] **代理服务**
  - [ ] `GET /hls/*` - HLS文件代理：
    - [ ] 会话验证
    - [ ] 请求转发到VPS
    - [ ] 响应头处理
    - [ ] 缓存策略配置

#### **错误处理和中间件**
- [ ] **通用中间件**
  - [ ] 会话验证中间件
  - [ ] 权限检查中间件
  - [ ] 请求日志中间件
  - [ ] 错误处理中间件

- [ ] **响应格式标准化**
  - [ ] 成功响应格式
  - [ ] 错误响应格式
  - [ ] HTTP状态码规范

### **前端工程师任务**

#### **项目初始化和环境搭建**
- [ ] **选择前端框架**
  - [ ] 决定使用Vue.js 3或React 18
  - [ ] 创建项目：`npm create vue@latest frontend` 或 `npx create-react-app frontend`
  - [ ] 配置开发环境和构建工具

- [ ] **安装核心依赖**
  - [ ] 安装路由库：vue-router或react-router-dom
  - [ ] 安装状态管理：pinia或redux-toolkit
  - [ ] 安装UI组件库：element-plus、ant-design-vue或antd
  - [ ] 安装视频播放器：hls.js
  - [ ] 安装HTTP客户端：axios
  - [ ] 安装工具库：lodash、dayjs

#### **应用架构和路由设计**
- [ ] **路由配置**
  - [ ] `/login` - 登录页面(公开)
  - [ ] `/` - 主页面(需认证)
  - [ ] `/admin` - 管理员页面(需管理员权限)
  - [ ] 实现路由守卫和权限控制

- [ ] **状态管理设计**
  - [ ] 用户认证状态(用户信息、登录状态)
  - [ ] 频道列表状态
  - [ ] 播放器状态
  - [ ] 全局UI状态(loading、错误信息)

#### **核心组件开发**
- [ ] **App.vue/App.jsx - 根组件**
  - [ ] 整体布局设计
  - [ ] 路由出口配置
  - [ ] 全局样式导入
  - [ ] 初始化状态管理

- [ ] **Login.vue/Login.jsx - 登录页面**
  - [ ] 登录表单设计(用户名、密码)
  - [ ] 表单验证逻辑
  - [ ] 登录API调用
  - [ ] 错误信息显示
  - [ ] 登录成功后跳转逻辑

- [ ] **Dashboard.vue/Dashboard.jsx - 主仪表板**
  - [ ] 用户信息显示
  - [ ] 导航菜单(频道列表、管理员功能)
  - [ ] 登出按钮
  - [ ] 响应式布局设计

- [ ] **StreamList.vue/StreamList.jsx - 频道列表**
  - [ ] 频道卡片/列表展示
  - [ ] 播放按钮交互
  - [ ] 加载状态处理
  - [ ] 空状态和错误处理
  - [ ] 搜索和过滤功能(可选)

- [ ] **VideoPlayer.vue/VideoPlayer.jsx - 视频播放器**
  - [ ] hls.js集成和初始化
  - [ ] 播放器控件(播放/暂停、音量、全屏)
  - [ ] 加载状态和进度显示
  - [ ] 错误处理和重试机制
  - [ ] 播放器自适应尺寸
  - [ ] 播放统计和心跳上报(可选)

- [ ] **AdminPanel.vue/AdminPanel.jsx - 管理员面板**
  - [ ] 管理员权限检查
  - [ ] 功能模块导航
  - [ ] 系统状态概览(可选)

- [ ] **StreamManager.vue/StreamManager.jsx - 频道管理**
  - [ ] 频道列表展示(管理员视图)
  - [ ] 添加频道表单:
    - [ ] 频道名称输入
    - [ ] RTMP URL输入
    - [ ] 表单验证
  - [ ] 编辑频道功能:
    - [ ] 内联编辑或弹窗编辑
    - [ ] 数据回填和更新
  - [ ] 删除频道功能:
    - [ ] 确认对话框
    - [ ] 删除API调用
  - [ ] 批量操作(可选)

#### **用户体验优化**
- [ ] **响应式设计**
  - [ ] 移动端适配
  - [ ] 平板端适配
  - [ ] 桌面端优化

- [ ] **交互优化**
  - [ ] Loading状态指示器
  - [ ] 操作反馈(Toast、Message)
  - [ ] 确认对话框
  - [ ] 快捷键支持(可选)

- [ ] **性能优化**
  - [ ] 组件懒加载
  - [ ] 图片懒加载
  - [ ] API请求去重和缓存
  - [ ] 虚拟滚动(如频道很多)

#### **样式和主题设计**
- [ ] **UI设计系统**
  - [ ] 色彩规范定义
  - [ ] 字体和字号规范
  - [ ] 间距和布局规范
  - [ ] 组件样式规范

- [ ] **响应式布局**
  - [ ] 断点设计(手机、平板、桌面)
  - [ ] Flexbox/Grid布局
  - [ ] 媒体查询优化

---

## **🧪 阶段四：集成测试与部署 (2-3天)**

### **测试工程师/全体开发**
- [ ] **单元测试**
  - [ ] 后端API单元测试
  - [ ] 前端组件单元测试
  - [ ] 工具函数测试
  - [ ] 测试覆盖率>80%

- [ ] **集成测试**
  - [ ] API集成测试
  - [ ] 端到端用户流程测试:
    - [ ] 管理员登录→添加频道→配置完成
    - [ ] 普通用户登录→选择频道→观看视频→切换频道
    - [ ] 多用户同时观看测试
    - [ ] 频道管理CRUD操作测试
  - [ ] 浏览器兼容性测试

- [ ] **性能测试**
  - [ ] 并发用户压力测试(目标50用户)
  - [ ] 视频转码性能测试
  - [ ] API响应时间测试
  - [ ] 内存和CPU使用率监控

### **运维工程师/项目负责人**
- [ ] **安全配置加固**
  - [ ] Cloudflare防火墙规则配置:
    - [ ] 仅允许Cloudflare IP访问VPS
    - [ ] 配置DDoS保护
    - [ ] 设置访问频率限制
  - [ ] VPS安全配置:
    - [ ] 关闭不必要的端口
    - [ ] 配置fail2ban
    - [ ] 设置定期安全更新
  - [ ] API密钥和Secrets管理:
    - [ ] 生成强密码API密钥
    - [ ] 在Worker中配置Secrets
    - [ ] 验证密钥正确配置

- [ ] **HTTPS和SSL配置**
  - [ ] 强制HTTPS访问
  - [ ] SSL证书配置和自动续期
  - [ ] 安全头配置(HSTS、CSP等)

- [ ] **监控和告警配置**
  - [ ] 系统资源监控
  - [ ] 服务可用性监控
  - [ ] 错误日志监控
  - [ ] 告警通知配置

### **部署和发布**
- [ ] **生产环境部署**
  - [ ] VPS生产环境配置
  - [ ] 数据库迁移和初始化
  - [ ] PM2生产环境配置
  - [ ] Nginx生产配置优化

- [ ] **Worker部署**
  - [ ] 使用wrangler部署到生产环境
  - [ ] 环境变量和Secrets配置
  - [ ] 自定义域名绑定(如有)
  - [ ] 部署验证和回滚准备

- [ ] **前端构建和部署**
  - [ ] 生产环境构建优化
  - [ ] 静态资源CDN配置
  - [ ] 缓存策略配置

### **文档和交接**
- [ ] **技术文档编写**
  - [ ] API文档(Swagger/OpenAPI)
  - [ ] 部署和运维手册
  - [ ] 故障排查指南
  - [ ] 性能调优指南

- [ ] **用户手册**
  - [ ] 管理员操作手册
  - [ ] 普通用户使用指南
  - [ ] 常见问题解答

- [ ] **代码和配置管理**
  - [ ] 代码审查和优化
  - [ ] 配置文件模板化
  - [ ] 备份和恢复流程
  - [ ] Git标签和版本发布

---

## **📊 关键验收标准**

### **功能验收Checklist**
- [ ] 管理员可以添加、编辑、删除频道配置
- [ ] 普通用户可以登录并查看频道列表
- [ ] 视频播放功能正常，延迟≤5秒
- [ ] 多用户可以同时观看不同频道
- [ ] 频道切换流畅，耗时≤3秒
- [ ] 所有CRUD操作响应时间≤500ms

### **性能验收Checklist**
- [ ] 支持50个并发用户
- [ ] 支持10个并发转码流
- [ ] 系统资源利用率≤80%
- [ ] 页面加载时间≤2秒

### **安全验收Checklist**
- [ ] 所有API接口需要认证
- [ ] 密码安全哈希存储
- [ ] 会话安全管理
- [ ] VPS源站保护有效
- [ ] HTTPS强制访问

---

## **⚠️ 风险和注意事项**

### **技术风险**
- [ ] **FFmpeg性能瓶颈**
  - 监控CPU和内存使用率
  - 准备水平扩展方案
- [ ] **网络延迟和稳定性**
  - 配置网络监控
  - 实现自动重连机制
- [ ] **浏览器兼容性问题**
  - 重点测试hls.js在不同浏览器的表现
  - 准备降级方案

### **项目管理风险**
- [ ] **并行开发协调**
  - 定期代码合并和集成
  - API接口提前定义和Mock
- [ ] **测试环境一致性**
  - 使用Docker容器化(推荐)
  - 环境配置文档化

---

**📅 建议执行顺序**:
1. 基础设施搭建(并行进行)
2. 后端API开发(优先级最高)
3. Worker业务逻辑开发
4. 前端界面开发(可与Worker并行)
5. 集成测试和部署

**👥 人力资源分配建议**:
- 后端工程师 × 1-2人(核心)
- 前端工程师 × 1人
- 全栈工程师 × 1人(Worker开发)
- 运维工程师 × 0.5人(兼职)