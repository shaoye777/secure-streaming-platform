{
  "version": 3,
  "sources": ["../bundle-eqpmp8/checked-fetch.js", "../../../src/router.js", "../../../src/utils/cors.js", "../../../src/utils/logger.js", "../../../src/utils/kv.js", "../../../src/utils/crypto.js", "../../../src/handlers/auth.js", "../../../src/handlers/streams.js", "../../../src/utils/cache.js", "../../../src/handlers/admin.js", "../../../src/handlers/proxy.js", "../../../src/handlers/pages.js", "../../../src/index.js", "../../../../../../../../../Program Files/nodejs/node_global/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../../../../../Program Files/nodejs/node_global/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-eqpmp8/middleware-insertion-facade.js", "../../../../../../../../../Program Files/nodejs/node_global/node_modules/wrangler/templates/middleware/common.ts", "../bundle-eqpmp8/middleware-loader.entry.ts"],
  "sourceRoot": "D:\\\u9879\u76EE\u6587\u4EF6\\yoyo-kindergarten\\code\\secure-streaming-platform\\vps-transcoder-api\\cloudflare-worker\\.wrangler\\tmp\\dev-IClKiw",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "/**\r\n * \u7B80\u5355\u7684\u8DEF\u7531\u5668\u5B9E\u73B0\r\n */\r\n\r\nexport class Router {\r\n  constructor() {\r\n    this.routes = [];\r\n  }\r\n\r\n  /**\r\n   * \u6CE8\u518CGET\u8DEF\u7531\r\n   */\r\n  get(path, handler) {\r\n    this.routes.push({\r\n      method: 'GET',\r\n      path,\r\n      handler,\r\n      regex: this.pathToRegex(path)\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \u6CE8\u518CPOST\u8DEF\u7531\r\n   */\r\n  post(path, handler) {\r\n    this.routes.push({\r\n      method: 'POST',\r\n      path,\r\n      handler,\r\n      regex: this.pathToRegex(path)\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \u6CE8\u518CPUT\u8DEF\u7531\r\n   */\r\n  put(path, handler) {\r\n    this.routes.push({\r\n      method: 'PUT',\r\n      path,\r\n      handler,\r\n      regex: this.pathToRegex(path)\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \u6CE8\u518CDELETE\u8DEF\u7531\r\n   */\r\n  delete(path, handler) {\r\n    this.routes.push({\r\n      method: 'DELETE',\r\n      path,\r\n      handler,\r\n      regex: this.pathToRegex(path)\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \u5C06\u8DEF\u5F84\u8F6C\u6362\u4E3A\u6B63\u5219\u8868\u8FBE\u5F0F\r\n   */\r\n  pathToRegex(path) {\r\n    // \u5904\u7406\u53C2\u6570\u5360\u4F4D\u7B26\uFF0C\u5982 :id -> ([^/]+)\r\n    const regexPath = path\r\n      .replace(/:\\w+/g, '([^/]+)')  // \u53C2\u6570\u5360\u4F4D\u7B26\r\n      .replace(/\\*/g, '(.*)');      // \u901A\u914D\u7B26\r\n\r\n    return new RegExp(`^${regexPath}$`);\r\n  }\r\n\r\n  /**\r\n   * \u63D0\u53D6\u8DEF\u5F84\u53C2\u6570\r\n   */\r\n  extractParams(path, pathname, regex) {\r\n    const matches = pathname.match(regex);\r\n    if (!matches) return {};\r\n\r\n    const paramNames = [];\r\n    const paramRegex = /:(\\w+)/g;\r\n    let match;\r\n    while ((match = paramRegex.exec(path)) !== null) {\r\n      paramNames.push(match[1]);\r\n    }\r\n\r\n    const params = {};\r\n    paramNames.forEach((name, index) => {\r\n      params[name] = matches[index + 1];\r\n    });\r\n\r\n    return params;\r\n  }\r\n\r\n  /**\r\n   * \u5904\u7406\u8BF7\u6C42\r\n   */\r\n  async handle(request, env, ctx) {\r\n    const url = new URL(request.url);\r\n    const method = request.method;\r\n    const pathname = url.pathname;\r\n\r\n    // \u67E5\u627E\u5339\u914D\u7684\u8DEF\u7531\r\n    for (const route of this.routes) {\r\n      if (route.method === method && route.regex.test(pathname)) {\r\n        try {\r\n          // \u63D0\u53D6\u8DEF\u5F84\u53C2\u6570\r\n          const params = this.extractParams(route.path, pathname, route.regex);\r\n\r\n          // \u5C06\u53C2\u6570\u548C\u67E5\u8BE2\u5B57\u7B26\u4E32\u6DFB\u52A0\u5230request\u5BF9\u8C61\u4E0A\uFF0C\u800C\u4E0D\u662F\u521B\u5EFA\u65B0\u5BF9\u8C61\r\n          request.params = params;\r\n          request.query = Object.fromEntries(url.searchParams);\r\n          request.pathname = pathname;\r\n\r\n          // \u8C03\u7528\u5904\u7406\u5668\uFF0C\u4F20\u9012\u539F\u59CBrequest\u5BF9\u8C61\r\n          return await route.handler(request, env, ctx);\r\n        } catch (error) {\r\n          console.error(`Route handler error for ${method} ${pathname}:`, error);\r\n          throw error;\r\n        }\r\n      }\r\n    }\r\n\r\n    // \u6CA1\u6709\u627E\u5230\u5339\u914D\u7684\u8DEF\u7531\r\n    return null;\r\n  }\r\n}\r\n", "/**\r\n * CORS\u5DE5\u5177\u51FD\u6570\r\n */\r\n\r\n// \u5141\u8BB8\u7684\u57DF\u540D\u5217\u8868\r\nconst ALLOWED_ORIGINS = [\r\n  'https://streaming.yourdomain.com',\r\n  'https://admin.yourdomain.com',\r\n  'http://localhost:3000',\r\n  'http://localhost:5173',\r\n  'http://127.0.0.1:3000',\r\n  'http://127.0.0.1:5173',\r\n  'https://127.0.0.1:8787',\r\n  'http://127.0.0.1:8787'\r\n];\r\n\r\n/**\r\n * \u83B7\u53D6CORS headers\r\n */\r\nexport function getCorsHeaders(request = null) {\r\n  let origin = '*';\r\n\r\n  if (request && request.headers) {\r\n    const requestOrigin = request.headers.get('Origin');\r\n    if (requestOrigin && ALLOWED_ORIGINS.includes(requestOrigin)) {\r\n      origin = requestOrigin;\r\n    } else if (ALLOWED_ORIGINS.length > 0) {\r\n      origin = ALLOWED_ORIGINS[0];\r\n    }\r\n  }\r\n\r\n  return {\r\n    'Access-Control-Allow-Origin': origin,\r\n    'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\r\n    'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Requested-With, CF-Connecting-IP, CF-Ray',\r\n    'Access-Control-Expose-Headers': 'Set-Cookie',\r\n    'Access-Control-Allow-Credentials': 'true',\r\n    'Access-Control-Max-Age': '86400', // 24\u5C0F\u65F6\r\n    'Vary': 'Origin'\r\n  };\r\n}\r\n\r\n/**\r\n * \u5904\u7406OPTIONS\u9884\u68C0\u8BF7\u6C42\r\n */\r\nexport function handleOptions(request) {\r\n  return new Response(null, {\r\n    status: 204,\r\n    headers: getCorsHeaders(request)\r\n  });\r\n}\r\n\r\n/**\r\n * \u521B\u5EFA\u5E26CORS\u5934\u7684\u54CD\u5E94\r\n */\r\nexport function createCorsResponse(body, options = {}) {\r\n  const { status = 200, headers = {}, request } = options;\r\n\r\n  const corsHeaders = request ? getCorsHeaders(request) : {\r\n    'Access-Control-Allow-Origin': '*',\r\n    'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\r\n    'Access-Control-Allow-Headers': 'Content-Type, Authorization'\r\n  };\r\n\r\n  return new Response(body, {\r\n    status,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      ...corsHeaders,\r\n      ...headers\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * \u521B\u5EFAJSON\u54CD\u5E94\uFF08\u5E26CORS\uFF09\r\n */\r\nexport function jsonResponse(data, options = {}) {\r\n  const body = typeof data === 'string' ? data : JSON.stringify(data, null, 2);\r\n  return createCorsResponse(body, options);\r\n}\r\n\r\n/**\r\n * \u521B\u5EFA\u9519\u8BEF\u54CD\u5E94\r\n */\r\nexport function errorResponse(message, code = 'ERROR', status = 500, request = null) {\r\n  const errorData = {\r\n    status: 'error',\r\n    message,\r\n    code,\r\n    timestamp: new Date().toISOString()\r\n  };\r\n\r\n  return jsonResponse(errorData, { status, request });\r\n}\r\n\r\n/**\r\n * \u521B\u5EFA\u6210\u529F\u54CD\u5E94\r\n */\r\nexport function successResponse(data, message = 'Success', request = null) {\r\n  const responseData = {\r\n    status: 'success',\r\n    message,\r\n    data,\r\n    timestamp: new Date().toISOString()\r\n  };\r\n\r\n  return jsonResponse(responseData, { request });\r\n}\r\n", "/**\r\n * \u65E5\u5FD7\u5DE5\u5177\u51FD\u6570\r\n */\r\n\r\n/**\r\n * \u8BB0\u5F55\u4FE1\u606F\u65E5\u5FD7\r\n */\r\nexport function logInfo(env, message, data = {}) {\r\n  const logEntry = {\r\n    level: 'INFO',\r\n    message,\r\n    data,\r\n    timestamp: new Date().toISOString(),\r\n    service: 'cloudflare-worker'\r\n  };\r\n\r\n  console.log(JSON.stringify(logEntry));\r\n\r\n  // \u5728\u751F\u4EA7\u73AF\u5883\u4E2D\u53EF\u4EE5\u53D1\u9001\u5230\u5916\u90E8\u65E5\u5FD7\u670D\u52A1\r\n  if (env.ENVIRONMENT === 'production') {\r\n    // \u4F8B\u5982\u53D1\u9001\u5230 Logflare, Datadog \u7B49\r\n  }\r\n}\r\n\r\n/**\r\n * \u8BB0\u5F55\u8B66\u544A\u65E5\u5FD7\r\n */\r\nexport function logWarn(env, message, data = {}) {\r\n  const logEntry = {\r\n    level: 'WARN',\r\n    message,\r\n    data,\r\n    timestamp: new Date().toISOString(),\r\n    service: 'cloudflare-worker'\r\n  };\r\n\r\n  console.warn(JSON.stringify(logEntry));\r\n}\r\n\r\n/**\r\n * \u8BB0\u5F55\u9519\u8BEF\u65E5\u5FD7\r\n */\r\nexport function logError(env, message, error, data = {}) {\r\n  const logEntry = {\r\n    level: 'ERROR',\r\n    message,\r\n    error: {\r\n      name: error?.name,\r\n      message: error?.message,\r\n      stack: error?.stack\r\n    },\r\n    data,\r\n    timestamp: new Date().toISOString(),\r\n    service: 'cloudflare-worker'\r\n  };\r\n\r\n  console.error(JSON.stringify(logEntry));\r\n\r\n  // \u5728\u751F\u4EA7\u73AF\u5883\u4E2D\u53D1\u9001\u9519\u8BEF\u62A5\u544A\r\n  if (env.ENVIRONMENT === 'production') {\r\n    // \u53D1\u9001\u5230\u9519\u8BEF\u8DDF\u8E2A\u670D\u52A1\r\n  }\r\n}\r\n\r\n/**\r\n * \u8BB0\u5F55API\u8BF7\u6C42\u65E5\u5FD7\r\n */\r\nexport function logApiRequest(env, request, response, duration, extras = {}) {\r\n  const logEntry = {\r\n    level: 'INFO',\r\n    type: 'API_REQUEST',\r\n    method: request.method,\r\n    url: request.url,\r\n    pathname: new URL(request.url).pathname,\r\n    statusCode: response?.status,\r\n    duration: `${duration}ms`,\r\n    userAgent: request.headers.get('User-Agent'),\r\n    cfRay: request.headers.get('CF-Ray'),\r\n    cfConnectingIp: request.headers.get('CF-Connecting-IP'),\r\n    cfCountry: request.headers.get('CF-IPCountry'),\r\n    timestamp: new Date().toISOString(),\r\n    ...extras\r\n  };\r\n\r\n  console.log(JSON.stringify(logEntry));\r\n}\r\n\r\n/**\r\n * \u8BB0\u5F55\u8BA4\u8BC1\u4E8B\u4EF6\r\n */\r\nexport function logAuthEvent(env, event, username, request, success = true, extras = {}) {\r\n  const logEntry = {\r\n    level: success ? 'INFO' : 'WARN',\r\n    type: 'AUTH_EVENT',\r\n    event,\r\n    username,\r\n    success,\r\n    ip: request.headers.get('CF-Connecting-IP'),\r\n    userAgent: request.headers.get('User-Agent'),\r\n    cfRay: request.headers.get('CF-Ray'),\r\n    cfCountry: request.headers.get('CF-IPCountry'),\r\n    timestamp: new Date().toISOString(),\r\n    ...extras\r\n  };\r\n\r\n  console.log(JSON.stringify(logEntry));\r\n}\r\n\r\n/**\r\n * \u8BB0\u5F55\u6D41\u5A92\u4F53\u4E8B\u4EF6\r\n */\r\nexport function logStreamEvent(env, event, streamId, username, request, extras = {}) {\r\n  const logEntry = {\r\n    level: 'INFO',\r\n    type: 'STREAM_EVENT',\r\n    event,\r\n    streamId,\r\n    username,\r\n    ip: request.headers.get('CF-Connecting-IP'),\r\n    userAgent: request.headers.get('User-Agent'),\r\n    cfRay: request.headers.get('CF-Ray'),\r\n    timestamp: new Date().toISOString(),\r\n    ...extras\r\n  };\r\n\r\n  console.log(JSON.stringify(logEntry));\r\n}\r\n", "/**\n * Cloudflare KV\u5B58\u50A8\u5DE5\u5177\u51FD\u6570\n */\n\nimport { logError, logInfo } from './logger.js';\n\n/**\n * \u83B7\u53D6\u7528\u6237\u6570\u636E\n */\nexport async function getUser(env, username) {\n  try {\n    const userKey = `user:${username}`;\n    const userData = await env.YOYO_USER_DB.get(userKey, 'json');\n\n    if (!userData) {\n      return null;\n    }\n\n    // \u9A8C\u8BC1\u6570\u636E\u5B8C\u6574\u6027\n    if (!userData.username || !userData.hashedPassword || !userData.salt) {\n      logError(env, 'Invalid user data structure', new Error('Missing required fields'), { username });\n      return null;\n    }\n\n    return userData;\n  } catch (error) {\n    logError(env, 'Failed to get user from KV', error, { username });\n    return null;\n  }\n}\n\n/**\n * \u521B\u5EFA\u6216\u66F4\u65B0\u7528\u6237\u6570\u636E\n */\nexport async function setUser(env, userData) {\n  try {\n    const userKey = `user:${userData.username}`;\n\n    const userRecord = {\n      username: userData.username,\n      hashedPassword: userData.hashedPassword,\n      salt: userData.salt,\n      role: userData.role || 'user',\n      createdAt: userData.createdAt || new Date().toISOString(),\n      updatedAt: new Date().toISOString()\n    };\n\n    await env.YOYO_USER_DB.put(userKey, JSON.stringify(userRecord));\n    logInfo(env, 'User data saved to KV', { username: userData.username, role: userRecord.role });\n\n    return userRecord;\n  } catch (error) {\n    logError(env, 'Failed to save user to KV', error, { username: userData.username });\n    throw error;\n  }\n}\n\n/**\n * \u521B\u5EFA\u4F1A\u8BDD\n */\nexport async function createSession(env, sessionId, username, expirationMs = 86400000) {\n  try {\n    const sessionKey = `session:${sessionId}`;\n    const expiresAt = Date.now() + expirationMs;\n    const sessionData = {\n      sessionId,\n      username,\n      createdAt: new Date().toISOString(),\n      expiresAt\n    };\n\n    // \u8BBE\u7F6ETTL\uFF08\u79D2\uFF09\n    const ttlSeconds = Math.floor(expirationMs / 1000);\n    await env.YOYO_USER_DB.put(sessionKey, JSON.stringify(sessionData), {\n      expirationTtl: ttlSeconds\n    });\n\n    logInfo(env, 'Session created', { sessionId, username, expiresAt: new Date(expiresAt).toISOString() });\n\n    return sessionData;\n  } catch (error) {\n    logError(env, 'Failed to create session', error, { sessionId, username });\n    throw error;\n  }\n}\n\n/**\n * \u83B7\u53D6\u4F1A\u8BDD\u6570\u636E\n */\nexport async function getSession(env, sessionId) {\n  try {\n    const sessionKey = `session:${sessionId}`;\n    const sessionData = await env.YOYO_USER_DB.get(sessionKey, 'json');\n\n    if (!sessionData) {\n      return null;\n    }\n\n    // \u68C0\u67E5\u4F1A\u8BDD\u662F\u5426\u8FC7\u671F\n    if (sessionData.expiresAt && Date.now() > sessionData.expiresAt) {\n      // \u4F1A\u8BDD\u5DF2\u8FC7\u671F\uFF0C\u5220\u9664\u5B83\n      await deleteSession(env, sessionId);\n      return null;\n    }\n\n    return sessionData;\n  } catch (error) {\n    logError(env, 'Failed to get session from KV', error, { sessionId });\n    return null;\n  }\n}\n\n/**\n * \u5220\u9664\u4F1A\u8BDD\n */\nexport async function deleteSession(env, sessionId) {\n  try {\n    const sessionKey = `session:${sessionId}`;\n    await env.YOYO_USER_DB.delete(sessionKey);\n    logInfo(env, 'Session deleted', { sessionId });\n  } catch (error) {\n    logError(env, 'Failed to delete session', error, { sessionId });\n  }\n}\n\n/**\n * \u83B7\u53D6\u6D41\u914D\u7F6E\n */\nexport async function getStreamsConfig(env) {\n  try {\n    const streamsData = await env.YOYO_USER_DB.get('streams_config', 'json');\n    return streamsData || [];\n  } catch (error) {\n    logError(env, 'Failed to get streams config from KV', error);\n    return [];\n  }\n}\n\n/**\n * \u4FDD\u5B58\u6D41\u914D\u7F6E\n */\nexport async function setStreamsConfig(env, streamsConfig) {\n  try {\n    await env.YOYO_USER_DB.put('streams_config', JSON.stringify(streamsConfig));\n    logInfo(env, 'Streams config saved to KV', { count: streamsConfig.length });\n    return streamsConfig;\n  } catch (error) {\n    logError(env, 'Failed to save streams config to KV', error);\n    throw error;\n  }\n}\n\n/**\n * \u6DFB\u52A0\u6D41\u914D\u7F6E\n */\nexport async function addStreamConfig(env, streamConfig) {\n  try {\n    const streamsConfig = await getStreamsConfig(env);\n\n    // \u68C0\u67E5ID\u662F\u5426\u5DF2\u5B58\u5728\n    if (streamsConfig.find(stream => stream.id === streamConfig.id)) {\n      throw new Error(`Stream with ID '${streamConfig.id}' already exists`);\n    }\n\n    const newStream = {\n      id: streamConfig.id,\n      name: streamConfig.name,\n      rtmpUrl: streamConfig.rtmpUrl,\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString()\n    };\n\n    streamsConfig.push(newStream);\n    await setStreamsConfig(env, streamsConfig);\n\n    logInfo(env, 'Stream config added', { streamId: streamConfig.id, streamName: streamConfig.name });\n\n    return newStream;\n  } catch (error) {\n    logError(env, 'Failed to add stream config', error, { streamId: streamConfig.id });\n    throw error;\n  }\n}\n\n/**\n * \u66F4\u65B0\u6D41\u914D\u7F6E\n */\nexport async function updateStreamConfig(env, streamId, updates) {\n  try {\n    const streamsConfig = await getStreamsConfig(env);\n    const streamIndex = streamsConfig.findIndex(stream => stream.id === streamId);\n\n    if (streamIndex === -1) {\n      throw new Error(`Stream with ID '${streamId}' not found`);\n    }\n\n    // \u66F4\u65B0\u6D41\u914D\u7F6E\n    streamsConfig[streamIndex] = {\n      ...streamsConfig[streamIndex],\n      ...updates,\n      updatedAt: new Date().toISOString()\n    };\n\n    await setStreamsConfig(env, streamsConfig);\n\n    logInfo(env, 'Stream config updated', { streamId, updates });\n\n    return streamsConfig[streamIndex];\n  } catch (error) {\n    logError(env, 'Failed to update stream config', error, { streamId, updates });\n    throw error;\n  }\n}\n\n/**\n * \u5220\u9664\u6D41\u914D\u7F6E\n */\nexport async function deleteStreamConfig(env, streamId) {\n  try {\n    const streamsConfig = await getStreamsConfig(env);\n    const streamIndex = streamsConfig.findIndex(stream => stream.id === streamId);\n\n    if (streamIndex === -1) {\n      throw new Error(`Stream with ID '${streamId}' not found`);\n    }\n\n    const deletedStream = streamsConfig.splice(streamIndex, 1)[0];\n    await setStreamsConfig(env, streamsConfig);\n\n    logInfo(env, 'Stream config deleted', { streamId, streamName: deletedStream.name });\n\n    return deletedStream;\n  } catch (error) {\n    logError(env, 'Failed to delete stream config', error, { streamId });\n    throw error;\n  }\n}\n\n/**\n * \u83B7\u53D6\u7279\u5B9A\u6D41\u914D\u7F6E\n */\nexport async function getStreamConfig(env, streamId) {\n  try {\n    const streamsConfig = await getStreamsConfig(env);\n    return streamsConfig.find(stream => stream.id === streamId) || null;\n  } catch (error) {\n    logError(env, 'Failed to get stream config', error, { streamId });\n    return null;\n  }\n}\n\n/**\n * \u6279\u91CF\u64CD\u4F5C\uFF1A\u6E05\u7406\u8FC7\u671F\u4F1A\u8BDD\n */\nexport async function cleanupExpiredSessions(env) {\n  try {\n    // \u7531\u4E8EKV\u7684\u9650\u5236\uFF0C\u8FD9\u91CC\u53EA\u80FD\u8BB0\u5F55\u6E05\u7406\u8BF7\u6C42\n    // \u5B9E\u9645\u7684\u6E05\u7406\u7531TTL\u81EA\u52A8\u5904\u7406\n    logInfo(env, 'Session cleanup task executed (TTL-based cleanup active)');\n  } catch (error) {\n    logError(env, 'Failed to cleanup expired sessions', error);\n  }\n}\n", "/**\r\n * \u5BC6\u7801\u5B66\u5DE5\u5177\u51FD\u6570\r\n */\r\n\r\n/**\r\n * \u751F\u6210\u968F\u673A\u76D0\u503C\r\n */\r\nexport async function generateSalt(length = 32) {\r\n  const array = new Uint8Array(length);\r\n  crypto.getRandomValues(array);\r\n  return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\n/**\r\n * \u7B80\u5355SHA-256\u54C8\u5E0C\uFF08\u4E34\u65F6\u7528\u4E8E\u6D4B\u8BD5\uFF09\r\n */\r\nasync function simpleHashPassword(password, salt) {\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(password + salt);\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\nasync function simpleHashPasswordReverse(password, salt) {\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(salt + password);\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\nasync function hashPasswordOnly(password) {\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(password);\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\n/**\r\n * \u4F7F\u7528PBKDF2\u54C8\u5E0C\u5BC6\u7801\r\n */\r\nexport async function hashPassword(password, salt) {\r\n  const encoder = new TextEncoder();\r\n  const passwordBuffer = encoder.encode(password);\r\n  const saltBuffer = encoder.encode(salt);\r\n\r\n  // \u5BFC\u5165\u5BC6\u7801\u4F5C\u4E3A\u5BC6\u94A5\r\n  const key = await crypto.subtle.importKey(\r\n    'raw',\r\n    passwordBuffer,\r\n    { name: 'PBKDF2' },\r\n    false,\r\n    ['deriveBits']\r\n  );\r\n\r\n  // \u4F7F\u7528PBKDF2\u6D3E\u751F\u5BC6\u94A5\r\n  const derivedBits = await crypto.subtle.deriveBits(\r\n    {\r\n      name: 'PBKDF2',\r\n      salt: saltBuffer,\r\n      iterations: 100000,\r\n      hash: 'SHA-256'\r\n    },\r\n    key,\r\n    256 // 32\u5B57\u8282 = 256\u4F4D\r\n  );\r\n\r\n  // \u8F6C\u6362\u4E3A\u5341\u516D\u8FDB\u5236\u5B57\u7B26\u4E32\r\n  const hashArray = Array.from(new Uint8Array(derivedBits));\r\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\n/**\r\n * \u9A8C\u8BC1\u5BC6\u7801\uFF08\u652F\u6301\u4E24\u79CD\u54C8\u5E0C\u65B9\u5F0F\uFF09\r\n */\r\nexport async function verifyPassword(password, salt, hashedPassword) {\r\n  console.log('=== PASSWORD VERIFICATION DEBUG ===');\r\n  console.log('Input password:', password);\r\n  console.log('Input salt:', salt);\r\n  console.log('Expected hash:', hashedPassword);\r\n  \r\n  // \u5148\u5C1D\u8BD5\u7B80\u5355SHA-256\u9A8C\u8BC1\uFF08\u7528\u4E8E\u73B0\u6709\u6D4B\u8BD5\u6570\u636E\uFF09\r\n  if (salt === 'randomsalt123') {\r\n    console.log('Using simple SHA-256 verification for test data');\r\n    \r\n    // \u5C1D\u8BD5 password + salt\r\n    const simpleHash1 = await simpleHashPassword(password, salt);\r\n    console.log('Hash (password + salt):', simpleHash1);\r\n    if (simpleHash1 === hashedPassword) {\r\n      console.log('\u2705 Password verification successful (password + salt)');\r\n      return true;\r\n    }\r\n    \r\n    // \u5C1D\u8BD5 salt + password\r\n    const simpleHash2 = await simpleHashPasswordReverse(password, salt);\r\n    console.log('Hash (salt + password):', simpleHash2);\r\n    if (simpleHash2 === hashedPassword) {\r\n      console.log('\u2705 Password verification successful (salt + password)');\r\n      return true;\r\n    }\r\n    \r\n    // \u5C1D\u8BD5\u53EA\u7528password\uFF08\u4E0D\u52A0salt\uFF09\r\n    const simpleHash3 = await hashPasswordOnly(password);\r\n    console.log('Hash (password only):', simpleHash3);\r\n    if (simpleHash3 === hashedPassword) {\r\n      console.log('\u2705 Password verification successful (password only)');\r\n      return true;\r\n    }\r\n  }\r\n\r\n  // \u7136\u540E\u5C1D\u8BD5PBKDF2\u9A8C\u8BC1\r\n  console.log('Trying PBKDF2 verification');\r\n  const pbkdf2Hash = await hashPassword(password, salt);\r\n  console.log('PBKDF2 hash:', pbkdf2Hash);\r\n  const result = pbkdf2Hash === hashedPassword;\r\n  console.log('PBKDF2 verification result:', result);\r\n  return result;\r\n}\r\n\r\n/**\r\n * \u751F\u6210\u5B89\u5168\u7684\u4F1A\u8BDDID\r\n */\r\nexport function generateSessionId() {\r\n  return crypto.randomUUID();\r\n}\r\n\r\n/**\r\n * \u751F\u6210\u5B89\u5168\u7684\u968F\u673A\u5B57\u7B26\u4E32\r\n */\r\nexport function generateRandomString(length = 32) {\r\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n  const array = new Uint8Array(length);\r\n  crypto.getRandomValues(array);\r\n\r\n  return Array.from(array, byte => chars[byte % chars.length]).join('');\r\n}\r\n\r\n/**\r\n * \u521B\u5EFAHMAC\u7B7E\u540D\r\n */\r\nexport async function createHmacSignature(message, secret) {\r\n  const encoder = new TextEncoder();\r\n  const messageBuffer = encoder.encode(message);\r\n  const secretBuffer = encoder.encode(secret);\r\n\r\n  const key = await crypto.subtle.importKey(\r\n    'raw',\r\n    secretBuffer,\r\n    { name: 'HMAC', hash: 'SHA-256' },\r\n    false,\r\n    ['sign']\r\n  );\r\n\r\n  const signature = await crypto.subtle.sign('HMAC', key, messageBuffer);\r\n  const hashArray = new Uint8Array(signature);\r\n\r\n  return Array.from(hashArray, byte => byte.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\n/**\r\n * \u9A8C\u8BC1HMAC\u7B7E\u540D\r\n */\r\nexport async function verifyHmacSignature(message, signature, secret) {\r\n  const expectedSignature = await createHmacSignature(message, secret);\r\n  return expectedSignature === signature;\r\n}\r\n\r\n/**\r\n * \u65F6\u95F4\u5B89\u5168\u7684\u5B57\u7B26\u4E32\u6BD4\u8F83\r\n */\r\nexport function timingSafeEqual(a, b) {\r\n  if (a.length !== b.length) {\r\n    return false;\r\n  }\r\n\r\n  let result = 0;\r\n  for (let i = 0; i < a.length; i++) {\r\n    result |= a.charCodeAt(i) ^ b.charCodeAt(i);\r\n  }\r\n\r\n  return result === 0;\r\n}\r\n", "/**\r\n * \u8BA4\u8BC1\u76F8\u5173\u5904\u7406\u5668\r\n */\r\n\r\nimport { getUser, createSession, getSession, deleteSession } from '../utils/kv.js';\r\nimport { verifyPassword, generateSessionId } from '../utils/crypto.js';\r\nimport { errorResponse, successResponse } from '../utils/cors.js';\r\nimport { logAuthEvent, logError, logInfo } from '../utils/logger.js';\r\n\r\n/**\r\n * \u4ECE\u8BF7\u6C42\u4E2D\u63D0\u53D6\u4F1A\u8BDDID\r\n */\r\nfunction getSessionIdFromRequest(request) {\r\n  if (!request || !request.headers) {\r\n    return null;\r\n  }\r\n  \r\n  const cookieHeader = request.headers.get('Cookie');\r\n  if (!cookieHeader) return null;\r\n\r\n  const cookies = cookieHeader.split(';').reduce((acc, cookie) => {\r\n    const [key, value] = cookie.trim().split('=');\r\n    acc[key] = value;\r\n    return acc;\r\n  }, {});\r\n\r\n  return cookies.sessionId;\r\n}\r\n\r\n/**\r\n * \u9A8C\u8BC1\u7528\u6237\u4F1A\u8BDD\r\n */\r\nexport async function validateSession(request, env) {\r\n  try {\r\n    const sessionId = getSessionIdFromRequest(request);\r\n    if (!sessionId) {\r\n      return null;\r\n    }\r\n\r\n    const session = await getSession(env, sessionId);\r\n    if (!session) {\r\n      return null;\r\n    }\r\n\r\n    // \u83B7\u53D6\u7528\u6237\u8BE6\u7EC6\u4FE1\u606F\r\n    const user = await getUser(env, session.username);\r\n    if (!user) {\r\n      // \u4F1A\u8BDD\u5B58\u5728\u4F46\u7528\u6237\u4E0D\u5B58\u5728\uFF0C\u5220\u9664\u65E0\u6548\u4F1A\u8BDD\r\n      await deleteSession(env, sessionId);\r\n      return null;\r\n    }\r\n\r\n    return {\r\n      session,\r\n      user: {\r\n        username: user.username,\r\n        role: user.role,\r\n        createdAt: user.createdAt\r\n      }\r\n    };\r\n  } catch (error) {\r\n    logError(env, 'Session validation failed', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * \u9700\u8981\u8BA4\u8BC1\u7684\u4E2D\u95F4\u4EF6\r\n */\r\nexport function requireAuth(handler, requiredRole = null) {\r\n  return async (request, env, ctx) => {\r\n    const auth = await validateSession(request, env);\r\n    if (!auth) {\r\n      return errorResponse('Authentication required', 'AUTH_REQUIRED', 401, request);\r\n    }\r\n\r\n    // \u68C0\u67E5\u89D2\u8272\u6743\u9650\r\n    if (requiredRole && auth.user.role !== requiredRole && auth.user.role !== 'admin') {\r\n      logAuthEvent(env, 'access_denied', auth.user.username, request, false, { requiredRole, userRole: auth.user.role });\r\n      return errorResponse('Insufficient privileges', 'INSUFFICIENT_PRIVILEGES', 403, request);\r\n    }\r\n\r\n    // \u5C06\u8BA4\u8BC1\u4FE1\u606F\u6DFB\u52A0\u5230\u8BF7\u6C42\u4E2D\r\n    request.auth = auth;\r\n    return await handler(request, env, ctx);\r\n  };\r\n}\r\n\r\n/**\r\n * \u7528\u6237\u767B\u5F55\r\n */\r\nexport const handleAuth = {\r\n  async login(request, env, ctx) {\r\n    try {\r\n      const startTime = Date.now();\r\n      \r\n      // \u8C03\u8BD5\uFF1A\u8BB0\u5F55\u8BF7\u6C42\u4FE1\u606F\r\n      console.log('=== LOGIN REQUEST DEBUG ===');\r\n      console.log('Request object exists:', !!request);\r\n      console.log('Method:', request?.method);\r\n      console.log('URL:', request?.url);\r\n      \r\n      // \u5B89\u5168\u5730\u83B7\u53D6headers\u4FE1\u606F\r\n      if (request && request.headers) {\r\n        try {\r\n          console.log('Headers:', Object.fromEntries(request.headers.entries()));\r\n        } catch (e) {\r\n          console.log('Headers error:', e.message);\r\n          console.log('Headers type:', typeof request.headers);\r\n        }\r\n      } else {\r\n        console.log('Headers: undefined or missing');\r\n      }\r\n\r\n      // \u89E3\u6790\u8BF7\u6C42\u6570\u636E\r\n      let loginData;\r\n      try {\r\n        if (!request || typeof request.text !== 'function') {\r\n          console.log('ERROR: Invalid request object');\r\n          return errorResponse('Invalid request object', 'INVALID_REQUEST', 400, request);\r\n        }\r\n        \r\n        const requestText = await request.text();\r\n        console.log('Raw request body length:', requestText.length);\r\n        console.log('Raw request body:', requestText);\r\n        \r\n        if (!requestText || requestText.trim() === '') {\r\n          console.log('ERROR: Empty request body');\r\n          return errorResponse('Empty request body', 'EMPTY_BODY', 400, request);\r\n        }\r\n        \r\n        loginData = JSON.parse(requestText);\r\n        console.log('Parsed login data:', loginData);\r\n      } catch (error) {\r\n        console.error('JSON parse error:', error.message);\r\n        console.error('Error stack:', error.stack);\r\n        return errorResponse('Invalid JSON in request body', 'INVALID_JSON', 400, request);\r\n      }\r\n\r\n      const { username, password } = loginData;\r\n\r\n      // \u9A8C\u8BC1\u8F93\u5165\r\n      if (!username || !password) {\r\n        logAuthEvent(env, 'login_attempt', username || 'unknown', request, false, { reason: 'missing_credentials' });\r\n        return errorResponse('Username and password are required', 'MISSING_CREDENTIALS', 400, request);\r\n      }\r\n\r\n      // \u83B7\u53D6\u7528\u6237\u6570\u636E\r\n      const user = await getUser(env, username);\r\n      if (!user) {\r\n        logAuthEvent(env, 'login_attempt', username, request, false, { reason: 'user_not_found' });\r\n        return errorResponse('Invalid username or password', 'INVALID_CREDENTIALS', 401, request);\r\n      }\r\n\r\n      // \u9A8C\u8BC1\u5BC6\u7801\r\n      const isValidPassword = await verifyPassword(password, user.salt, user.hashedPassword);\r\n      if (!isValidPassword) {\r\n        logAuthEvent(env, 'login_attempt', username, request, false, { reason: 'invalid_password' });\r\n        return errorResponse('Invalid username or password', 'INVALID_CREDENTIALS', 401, request);\r\n      }\r\n\r\n      // \u521B\u5EFA\u4F1A\u8BDD\r\n      const sessionId = generateSessionId();\r\n      const sessionTimeout = parseInt(env.SESSION_TIMEOUT) || 86400000; // \u9ED8\u8BA424\u5C0F\u65F6\r\n      const session = await createSession(env, sessionId, username, sessionTimeout);\r\n\r\n      // \u8BB0\u5F55\u6210\u529F\u767B\u5F55\r\n      logAuthEvent(env, 'login_success', username, request, true, {\r\n        sessionId,\r\n        role: user.role,\r\n        responseTime: Date.now() - startTime\r\n      });\r\n\r\n      // \u521B\u5EFA\u54CD\u5E94\u6570\u636E\r\n      const responseData = {\r\n        user: {\r\n          username: user.username,\r\n          role: user.role,\r\n          createdAt: user.createdAt\r\n        },\r\n        session: {\r\n          sessionId: session.sessionId,\r\n          expiresAt: new Date(session.expiresAt).toISOString()\r\n        }\r\n      };\r\n\r\n      // \u521B\u5EFA\u54CD\u5E94\u5E76\u8BBE\u7F6ECookie\r\n      const response = successResponse(responseData, 'Login successful', request);\r\n\r\n      // \u8BBE\u7F6E\u5B89\u5168\u7684HttpOnly Cookie\r\n      const cookieValue = `sessionId=${sessionId}; HttpOnly; Secure; SameSite=Strict; Max-Age=${Math.floor(sessionTimeout / 1000)}; Path=/`;\r\n      response.headers.set('Set-Cookie', cookieValue);\r\n\r\n      return response;\r\n\r\n    } catch (error) {\r\n      logError(env, 'Login handler error', error, { url: request.url });\r\n      return errorResponse('Internal server error during login', 'LOGIN_ERROR', 500, request);\r\n    }\r\n  },\r\n\r\n  async logout(request, env, ctx) {\r\n    try {\r\n      const sessionId = getSessionIdFromRequest(request);\r\n\r\n      if (sessionId) {\r\n        // \u83B7\u53D6\u4F1A\u8BDD\u4FE1\u606F\u7528\u4E8E\u65E5\u5FD7\r\n        const session = await getSession(env, sessionId);\r\n        const username = session?.username || 'unknown';\r\n\r\n        // \u5220\u9664\u4F1A\u8BDD\r\n        await deleteSession(env, sessionId);\r\n\r\n        // \u8BB0\u5F55\u767B\u51FA\u4E8B\u4EF6\r\n        logAuthEvent(env, 'logout', username, request, true, { sessionId });\r\n      }\r\n\r\n      // \u521B\u5EFA\u54CD\u5E94\u5E76\u6E05\u9664Cookie\r\n      const response = successResponse(null, 'Logout successful', request);\r\n      response.headers.set('Set-Cookie', 'sessionId=; HttpOnly; Secure; SameSite=Strict; Max-Age=0; Path=/');\r\n\r\n      return response;\r\n\r\n    } catch (error) {\r\n      logError(env, 'Logout handler error', error);\r\n      return errorResponse('Internal server error during logout', 'LOGOUT_ERROR', 500, request);\r\n    }\r\n  },\r\n\r\n  async getCurrentUser(request, env, ctx) {\r\n    try {\r\n      const auth = await validateSession(request, env);\r\n      if (!auth) {\r\n        return errorResponse('Authentication required', 'AUTH_REQUIRED', 401, request);\r\n      }\r\n\r\n      return successResponse({\r\n        user: auth.user,\r\n        session: {\r\n          sessionId: auth.session.sessionId,\r\n          expiresAt: new Date(auth.session.expiresAt).toISOString()\r\n        }\r\n      }, 'User information retrieved', request);\r\n\r\n    } catch (error) {\r\n      logError(env, 'Get current user handler error', error);\r\n      return errorResponse('Internal server error', 'USER_INFO_ERROR', 500, request);\r\n    }\r\n  }\r\n};\r\n", "/**\r\n * \u6D41\u5A92\u4F53\u76F8\u5173\u5904\u7406\u5668\r\n */\r\n\r\nimport { getStreamsConfig, getStreamConfig } from '../utils/kv.js';\r\nimport { validateSession } from './auth.js';\r\nimport { errorResponse, successResponse } from '../utils/cors.js';\r\nimport { logStreamEvent, logError, logInfo } from '../utils/logger.js';\r\n\r\n/**\r\n * \u8C03\u7528VPS\u8F6C\u7801API\r\n */\r\nasync function callTranscoderAPI(env, endpoint, method = 'GET', data = null) {\r\n  try {\r\n    const vpsApiUrl = env.VPS_API_URL || 'http://your-vps-ip:3000';\r\n    const apiKey = env.VPS_API_KEY;\r\n\r\n    if (!apiKey) {\r\n      throw new Error('VPS API key not configured');\r\n    }\r\n\r\n    const url = `${vpsApiUrl}/api/${endpoint}`;\r\n    const options = {\r\n      method,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'X-API-Key': apiKey,\r\n        'User-Agent': 'Cloudflare-Worker/1.0'\r\n      }\r\n    };\r\n\r\n    if (data && (method === 'POST' || method === 'PUT')) {\r\n      options.body = JSON.stringify(data);\r\n    }\r\n\r\n    logInfo(env, 'Calling VPS transcoder API', {\r\n      url,\r\n      method,\r\n      endpoint,\r\n      hasData: !!data\r\n    });\r\n\r\n    const response = await fetch(url, options);\r\n    const responseText = await response.text();\r\n\r\n    let responseData;\r\n    try {\r\n      responseData = JSON.parse(responseText);\r\n    } catch (error) {\r\n      throw new Error(`Invalid JSON response from VPS API: ${responseText}`);\r\n    }\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`VPS API error (${response.status}): ${responseData.message || responseText}`);\r\n    }\r\n\r\n    logInfo(env, 'VPS transcoder API call successful', {\r\n      endpoint,\r\n      method,\r\n      status: response.status,\r\n      responseStatus: responseData.status\r\n    });\r\n\r\n    return responseData;\r\n\r\n  } catch (error) {\r\n    logError(env, 'VPS transcoder API call failed', error, { endpoint, method });\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * \u68C0\u67E5VPS\u670D\u52A1\u5668\u8FDE\u901A\u6027\r\n */\r\nasync function checkVpsHealth(env) {\r\n  try {\r\n    const vpsApiUrl = env.VPS_API_URL || 'http://your-vps-ip:3000';\r\n    const apiKey = env.VPS_API_KEY;\r\n\r\n    if (!apiKey) {\r\n      return { available: false, error: 'VPS API key not configured' };\r\n    }\r\n\r\n    const response = await fetch(`${vpsApiUrl}/api/health`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'X-API-Key': apiKey,\r\n        'User-Agent': 'Cloudflare-Worker-Health/1.0'\r\n      },\r\n      signal: AbortSignal.timeout(5000) // 5\u79D2\u8D85\u65F6\r\n    });\r\n\r\n    if (response.ok) {\r\n      const data = await response.json();\r\n      return { available: true, data };\r\n    } else {\r\n      return { available: false, error: `HTTP ${response.status}` };\r\n    }\r\n  } catch (error) {\r\n    return { available: false, error: error.message };\r\n  }\r\n}\r\n\r\nexport const handleStreams = {\r\n  /**\r\n   * \u83B7\u53D6\u6240\u6709\u53EF\u7528\u7684\u6D41\u5217\u8868\uFF08\u7528\u6237\u89C6\u56FE\uFF09\r\n   */\r\n  async getStreams(request, env, ctx) {\r\n    try {\r\n      // \u9A8C\u8BC1\u7528\u6237\u8BA4\u8BC1\r\n      const auth = await validateSession(request, env);\r\n      if (!auth) {\r\n        return errorResponse('Authentication required', 'AUTH_REQUIRED', 401, request);\r\n      }\r\n\r\n      // \u83B7\u53D6\u6D41\u914D\u7F6E\r\n      const streamsConfig = await getStreamsConfig(env);\r\n\r\n      // \u53EA\u8FD4\u56DE\u7528\u6237\u9700\u8981\u7684\u4FE1\u606F\uFF08\u9690\u85CF\u654F\u611F\u7684RTMP URL\uFF09\r\n      const publicStreams = streamsConfig.map(stream => ({\r\n        id: stream.id,\r\n        name: stream.name,\r\n        createdAt: stream.createdAt\r\n      }));\r\n\r\n      logInfo(env, 'Streams list retrieved', {\r\n        username: auth.user.username,\r\n        streamsCount: publicStreams.length\r\n      });\r\n\r\n      return successResponse({\r\n        streams: publicStreams,\r\n        count: publicStreams.length\r\n      }, 'Streams retrieved successfully', request);\r\n\r\n    } catch (error) {\r\n      logError(env, 'Get streams handler error', error);\r\n      return errorResponse('Failed to retrieve streams', 'STREAMS_ERROR', 500, request);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * \u8BF7\u6C42\u64AD\u653E\u6307\u5B9A\u6D41\r\n   */\r\n  async playStream(request, env, ctx) {\r\n    try {\r\n      const startTime = Date.now();\r\n\r\n      // \u9A8C\u8BC1\u7528\u6237\u8BA4\u8BC1\r\n      const auth = await validateSession(request, env);\r\n      if (!auth) {\r\n        return errorResponse('Authentication required', 'AUTH_REQUIRED', 401, request);\r\n      }\r\n\r\n      const { id: streamId } = request.params;\r\n      if (!streamId) {\r\n        return errorResponse('Stream ID is required', 'MISSING_STREAM_ID', 400, request);\r\n      }\r\n\r\n      // \u83B7\u53D6\u6D41\u914D\u7F6E\r\n      const streamConfig = await getStreamConfig(env, streamId);\r\n      if (!streamConfig) {\r\n        return errorResponse(`Stream '${streamId}' not found`, 'STREAM_NOT_FOUND', 404, request);\r\n      }\r\n\r\n      logStreamEvent(env, 'play_request', streamId, auth.user.username, request);\r\n\r\n      try {\r\n        // \u68C0\u67E5VPS\u670D\u52A1\u5668\u8FDE\u901A\u6027\r\n        const vpsHealth = await checkVpsHealth(env);\r\n        if (!vpsHealth.available) {\r\n          return errorResponse('VPS server is not available', 'VPS_UNAVAILABLE', 503, request);\r\n        }\r\n\r\n        // \u8C03\u7528VPS API\u542F\u52A8\u8F6C\u7801\r\n        const transcoderResponse = await callTranscoderAPI(env, 'start-stream', 'POST', {\r\n          streamId: streamConfig.id,\r\n          rtmpUrl: streamConfig.rtmpUrl\r\n        });\r\n\r\n        const responseTime = Date.now() - startTime;\r\n\r\n        logStreamEvent(env, 'play_success', streamId, auth.user.username, request, {\r\n          responseTime: `${responseTime}ms`,\r\n          processId: transcoderResponse.data?.processId\r\n        });\r\n\r\n        // \u8FD4\u56DEHLS\u64AD\u653E\u5730\u5740\r\n        const hlsUrl = `/hls/${streamId}/stream.m3u8`;\r\n\r\n        return successResponse({\r\n          streamId,\r\n          streamName: streamConfig.name,\r\n          hlsUrl,\r\n          transcoderInfo: {\r\n            processId: transcoderResponse.data?.processId,\r\n            status: transcoderResponse.status\r\n          },\r\n          responseTime\r\n        }, `Stream '${streamConfig.name}' started successfully`, request);\r\n\r\n      } catch (transcoderError) {\r\n        logStreamEvent(env, 'play_failed', streamId, auth.user.username, request, {\r\n          error: transcoderError.message,\r\n          responseTime: Date.now() - startTime\r\n        });\r\n\r\n        // \u6839\u636E\u9519\u8BEF\u7C7B\u578B\u8FD4\u56DE\u76F8\u5E94\u7684\u9519\u8BEF\u4FE1\u606F\r\n        if (transcoderError.message.includes('timeout')) {\r\n          return errorResponse(\r\n            'Stream startup timeout. Please try again.',\r\n            'STREAM_TIMEOUT',\r\n            504,\r\n            request\r\n          );\r\n        } else if (transcoderError.message.includes('Connection')) {\r\n          return errorResponse(\r\n            'Unable to connect to stream source. Please check the stream configuration.',\r\n            'STREAM_CONNECTION_ERROR',\r\n            502,\r\n            request\r\n          );\r\n        } else {\r\n          return errorResponse(\r\n            `Failed to start stream: ${transcoderError.message}`,\r\n            'STREAM_START_ERROR',\r\n            500,\r\n            request\r\n          );\r\n        }\r\n      }\r\n\r\n    } catch (error) {\r\n      logError(env, 'Play stream handler error', error, { streamId: request.params?.id });\r\n      return errorResponse('Failed to start stream playback', 'PLAY_ERROR', 500, request);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * \u505C\u6B62\u6307\u5B9A\u6D41\uFF08\u53EF\u9009\u529F\u80FD\uFF09\r\n   */\r\n  async stopStream(request, env, ctx) {\r\n    try {\r\n      // \u9A8C\u8BC1\u7528\u6237\u8BA4\u8BC1\r\n      const auth = await validateSession(request, env);\r\n      if (!auth) {\r\n        return errorResponse('Authentication required', 'AUTH_REQUIRED', 401, request);\r\n      }\r\n\r\n      const { id: streamId } = request.params;\r\n      if (!streamId) {\r\n        return errorResponse('Stream ID is required', 'MISSING_STREAM_ID', 400, request);\r\n      }\r\n\r\n      // \u68C0\u67E5\u6D41\u662F\u5426\u5B58\u5728\r\n      const streamConfig = await getStreamConfig(env, streamId);\r\n      if (!streamConfig) {\r\n        return errorResponse(`Stream '${streamId}' not found`, 'STREAM_NOT_FOUND', 404, request);\r\n      }\r\n\r\n      logStreamEvent(env, 'stop_request', streamId, auth.user.username, request);\r\n\r\n      try {\r\n        // \u68C0\u67E5VPS\u670D\u52A1\u5668\u8FDE\u901A\u6027\r\n        const vpsHealth = await checkVpsHealth(env);\r\n        if (!vpsHealth.available) {\r\n          return errorResponse('VPS server is not available', 'VPS_UNAVAILABLE', 503, request);\r\n        }\r\n\r\n        // \u8C03\u7528VPS API\u505C\u6B62\u8F6C\u7801\r\n        const transcoderResponse = await callTranscoderAPI(env, 'stop-stream', 'POST', {\r\n          streamId: streamId\r\n        });\r\n\r\n        logStreamEvent(env, 'stop_success', streamId, auth.user.username, request, {\r\n          processId: transcoderResponse.data?.processId\r\n        });\r\n\r\n        return successResponse({\r\n          streamId,\r\n          streamName: streamConfig.name,\r\n          transcoderInfo: {\r\n            processId: transcoderResponse.data?.processId,\r\n            status: transcoderResponse.status\r\n          }\r\n        }, `Stream '${streamConfig.name}' stopped successfully`, request);\r\n\r\n      } catch (transcoderError) {\r\n        logStreamEvent(env, 'stop_failed', streamId, auth.user.username, request, {\r\n          error: transcoderError.message\r\n        });\r\n\r\n        return errorResponse(\r\n          `Failed to stop stream: ${transcoderError.message}`,\r\n          'STREAM_STOP_ERROR',\r\n          500,\r\n          request\r\n        );\r\n      }\r\n\r\n    } catch (error) {\r\n      logError(env, 'Stop stream handler error', error, { streamId: request.params?.id });\r\n      return errorResponse('Failed to stop stream', 'STOP_ERROR', 500, request);\r\n    }\r\n  }\r\n};\r\n", "/**\r\n * \u7F13\u5B58\u5DE5\u5177\u51FD\u6570\r\n * \u7528\u4E8E\u4F18\u5316API\u54CD\u5E94\u6027\u80FD\r\n */\r\n\r\nimport { logInfo, logError } from './logger.js';\r\n\r\n/**\r\n * \u5185\u5B58\u7F13\u5B58\uFF08Worker\u751F\u547D\u5468\u671F\u5185\u6709\u6548\uFF09\r\n */\r\nconst memoryCache = new Map();\r\n\r\n/**\r\n * \u7F13\u5B58\u914D\u7F6E\r\n */\r\nconst CACHE_CONFIG = {\r\n  streams: {\r\n    ttl: 30000, // 30\u79D2\r\n    key: 'streams_list'\r\n  },\r\n  vpsHealth: {\r\n    ttl: 10000, // 10\u79D2\r\n    key: 'vps_health'\r\n  },\r\n  systemStatus: {\r\n    ttl: 60000, // 60\u79D2\r\n    key: 'system_status'\r\n  }\r\n};\r\n\r\n/**\r\n * \u8BBE\u7F6E\u7F13\u5B58\r\n */\r\nexport function setCache(key, data, ttl = 30000) {\r\n  try {\r\n    const cacheItem = {\r\n      data,\r\n      timestamp: Date.now(),\r\n      ttl\r\n    };\r\n\r\n    memoryCache.set(key, cacheItem);\r\n\r\n    // \u8BBE\u7F6E\u81EA\u52A8\u6E05\u7406\r\n    setTimeout(() => {\r\n      memoryCache.delete(key);\r\n    }, ttl);\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Cache set error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * \u83B7\u53D6\u7F13\u5B58\r\n */\r\nexport function getCache(key) {\r\n  try {\r\n    const cacheItem = memoryCache.get(key);\r\n\r\n    if (!cacheItem) {\r\n      return null;\r\n    }\r\n\r\n    // \u68C0\u67E5\u662F\u5426\u8FC7\u671F\r\n    if (Date.now() - cacheItem.timestamp > cacheItem.ttl) {\r\n      memoryCache.delete(key);\r\n      return null;\r\n    }\r\n\r\n    return cacheItem.data;\r\n  } catch (error) {\r\n    console.error('Cache get error:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * \u6E05\u9664\u7F13\u5B58\r\n */\r\nexport function clearCache(key = null) {\r\n  try {\r\n    if (key) {\r\n      memoryCache.delete(key);\r\n    } else {\r\n      memoryCache.clear();\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Cache clear error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * \u83B7\u53D6\u7F13\u5B58\u7EDF\u8BA1\r\n */\r\nexport function getCacheStats() {\r\n  const stats = {\r\n    totalItems: memoryCache.size,\r\n    items: []\r\n  };\r\n\r\n  for (const [key, item] of memoryCache.entries()) {\r\n    const age = Date.now() - item.timestamp;\r\n    const remaining = Math.max(0, item.ttl - age);\r\n\r\n    stats.items.push({\r\n      key,\r\n      age: `${Math.round(age / 1000)}s`,\r\n      remaining: `${Math.round(remaining / 1000)}s`,\r\n      expired: remaining <= 0\r\n    });\r\n  }\r\n\r\n  return stats;\r\n}\r\n\r\n/**\r\n * \u7F13\u5B58\u88C5\u9970\u5668\u51FD\u6570\r\n */\r\nexport function withCache(cacheKey, ttl = 30000) {\r\n  return function(target, propertyKey, descriptor) {\r\n    const originalMethod = descriptor.value;\r\n\r\n    descriptor.value = async function(...args) {\r\n      // \u5C1D\u8BD5\u4ECE\u7F13\u5B58\u83B7\u53D6\r\n      const cached = getCache(cacheKey);\r\n      if (cached) {\r\n        return cached;\r\n      }\r\n\r\n      // \u6267\u884C\u539F\u51FD\u6570\r\n      const result = await originalMethod.apply(this, args);\r\n\r\n      // \u7F13\u5B58\u7ED3\u679C\r\n      setCache(cacheKey, result, ttl);\r\n\r\n      return result;\r\n    };\r\n\r\n    return descriptor;\r\n  };\r\n}\r\n\r\n/**\r\n * \u667A\u80FD\u7F13\u5B58\u7BA1\u7406\r\n */\r\nexport class CacheManager {\r\n  constructor(env) {\r\n    this.env = env;\r\n  }\r\n\r\n  /**\r\n   * \u7F13\u5B58\u6D41\u914D\u7F6E\u5217\u8868\r\n   */\r\n  async cacheStreams(streamsData) {\r\n    const cacheKey = CACHE_CONFIG.streams.key;\r\n    const ttl = CACHE_CONFIG.streams.ttl;\r\n\r\n    setCache(cacheKey, streamsData, ttl);\r\n\r\n    logInfo(this.env, 'Streams data cached', {\r\n      cacheKey,\r\n      ttl: `${ttl / 1000}s`,\r\n      itemCount: streamsData.length\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \u83B7\u53D6\u7F13\u5B58\u7684\u6D41\u914D\u7F6E\r\n   */\r\n  getCachedStreams() {\r\n    return getCache(CACHE_CONFIG.streams.key);\r\n  }\r\n\r\n  /**\r\n   * \u7F13\u5B58VPS\u5065\u5EB7\u72B6\u6001\r\n   */\r\n  async cacheVpsHealth(healthData) {\r\n    const cacheKey = CACHE_CONFIG.vpsHealth.key;\r\n    const ttl = CACHE_CONFIG.vpsHealth.ttl;\r\n\r\n    setCache(cacheKey, healthData, ttl);\r\n\r\n    logInfo(this.env, 'VPS health data cached', {\r\n      cacheKey,\r\n      ttl: `${ttl / 1000}s`,\r\n      available: healthData.available\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \u83B7\u53D6\u7F13\u5B58\u7684VPS\u5065\u5EB7\u72B6\u6001\r\n   */\r\n  getCachedVpsHealth() {\r\n    return getCache(CACHE_CONFIG.vpsHealth.key);\r\n  }\r\n\r\n  /**\r\n   * \u7F13\u5B58\u7CFB\u7EDF\u72B6\u6001\r\n   */\r\n  async cacheSystemStatus(statusData) {\r\n    const cacheKey = CACHE_CONFIG.systemStatus.key;\r\n    const ttl = CACHE_CONFIG.systemStatus.ttl;\r\n\r\n    setCache(cacheKey, statusData, ttl);\r\n\r\n    logInfo(this.env, 'System status cached', {\r\n      cacheKey,\r\n      ttl: `${ttl / 1000}s`\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \u83B7\u53D6\u7F13\u5B58\u7684\u7CFB\u7EDF\u72B6\u6001\r\n   */\r\n  getCachedSystemStatus() {\r\n    return getCache(CACHE_CONFIG.systemStatus.key);\r\n  }\r\n\r\n  /**\r\n   * \u6E05\u9664\u6240\u6709\u76F8\u5173\u7F13\u5B58\r\n   */\r\n  clearAllCache() {\r\n    clearCache();\r\n    logInfo(this.env, 'All cache cleared');\r\n  }\r\n\r\n  /**\r\n   * \u83B7\u53D6\u7F13\u5B58\u7EDF\u8BA1\u4FE1\u606F\r\n   */\r\n  getStats() {\r\n    return getCacheStats();\r\n  }\r\n}\r\n", "/**\r\n * \u7BA1\u7406\u5458\u529F\u80FD\u5904\u7406\u5668\r\n */\r\n\r\nimport { \r\n  getStreamsConfig, \r\n  addStreamConfig, \r\n  updateStreamConfig, \r\n  deleteStreamConfig,\r\n  getStreamConfig \r\n} from '../utils/kv.js';\r\nimport { validateSession } from './auth.js';\r\nimport { errorResponse, successResponse } from '../utils/cors.js';\r\nimport { logError, logInfo } from '../utils/logger.js';\r\nimport { generateRandomString } from '../utils/crypto.js';\r\nimport { getCacheStats, clearCache } from '../utils/cache.js';\r\n\r\n/**\r\n * \u9A8C\u8BC1\u7BA1\u7406\u5458\u6743\u9650\r\n */\r\nasync function requireAdmin(request, env) {\r\n  const auth = await validateSession(request, env);\r\n  if (!auth) {\r\n    return { error: errorResponse('Authentication required', 'AUTH_REQUIRED', 401, request) };\r\n  }\r\n\r\n  if (auth.user.role !== 'admin') {\r\n    return { error: errorResponse('Admin privileges required', 'ADMIN_REQUIRED', 403, request) };\r\n  }\r\n\r\n  return { auth };\r\n}\r\n\r\n/**\r\n * \u9A8C\u8BC1\u6D41\u914D\u7F6E\u6570\u636E\r\n */\r\nfunction validateStreamData(data, isUpdate = false) {\r\n  const errors = [];\r\n\r\n  if (!isUpdate && (!data.id || typeof data.id !== 'string')) {\r\n    errors.push('Stream ID is required and must be a string');\r\n  }\r\n\r\n  if (data.id && !/^[a-zA-Z0-9_-]+$/.test(data.id)) {\r\n    errors.push('Stream ID can only contain letters, numbers, underscores and hyphens');\r\n  }\r\n\r\n  if (!data.name || typeof data.name !== 'string') {\r\n    errors.push('Stream name is required and must be a string');\r\n  }\r\n\r\n  if (data.name && data.name.trim().length === 0) {\r\n    errors.push('Stream name cannot be empty');\r\n  }\r\n\r\n  if (!data.rtmpUrl || typeof data.rtmpUrl !== 'string') {\r\n    errors.push('RTMP URL is required and must be a string');\r\n  }\r\n\r\n  if (data.rtmpUrl && !data.rtmpUrl.startsWith('rtmp://') && !data.rtmpUrl.startsWith('rtmps://')) {\r\n    errors.push('RTMP URL must start with rtmp:// or rtmps://');\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * \u8C03\u7528VPS API\u83B7\u53D6\u7CFB\u7EDF\u72B6\u6001\r\n */\r\nasync function getVpsStatus(env) {\r\n  try {\r\n    const vpsApiUrl = env.VPS_API_URL || 'http://your-vps-ip:3000';\r\n    const apiKey = env.VPS_API_KEY;\r\n\r\n    if (!apiKey) {\r\n      return { error: 'VPS API key not configured' };\r\n    }\r\n\r\n    const response = await fetch(`${vpsApiUrl}/api/status`, {\r\n      headers: {\r\n        'X-API-Key': apiKey,\r\n        'User-Agent': 'Cloudflare-Worker-Admin/1.0'\r\n      },\r\n      timeout: 10000 // 10\u79D2\u8D85\u65F6\r\n    });\r\n\r\n    if (!response.ok) {\r\n      return { error: `VPS API error: ${response.status}` };\r\n    }\r\n\r\n    const data = await response.json();\r\n    return { data };\r\n\r\n  } catch (error) {\r\n    return { error: error.message };\r\n  }\r\n}\r\n\r\nexport const handleAdmin = {\r\n  /**\r\n   * \u83B7\u53D6\u6240\u6709\u6D41\u914D\u7F6E\uFF08\u7BA1\u7406\u5458\u89C6\u56FE - \u5305\u542B\u654F\u611F\u4FE1\u606F\uFF09\r\n   */\r\n  async getStreams(request, env, ctx) {\r\n    try {\r\n      const { auth, error } = await requireAdmin(request, env);\r\n      if (error) return error;\r\n\r\n      const streamsConfig = await getStreamsConfig(env);\r\n\r\n      logInfo(env, 'Admin retrieved streams config', {\r\n        username: auth.user.username,\r\n        streamsCount: streamsConfig.length\r\n      });\r\n\r\n      return successResponse({\r\n        streams: streamsConfig,\r\n        count: streamsConfig.length\r\n      }, 'Streams configuration retrieved successfully', request);\r\n\r\n    } catch (error) {\r\n      logError(env, 'Admin get streams handler error', error);\r\n      return errorResponse('Failed to retrieve streams configuration', 'ADMIN_STREAMS_ERROR', 500, request);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * \u521B\u5EFA\u65B0\u7684\u6D41\u914D\u7F6E\r\n   */\r\n  async createStream(request, env, ctx) {\r\n    try {\r\n      const { auth, error } = await requireAdmin(request, env);\r\n      if (error) return error;\r\n\r\n      let streamData;\r\n      try {\r\n        streamData = await request.json();\r\n      } catch (error) {\r\n        return errorResponse('Invalid JSON in request body', 'INVALID_JSON', 400, request);\r\n      }\r\n\r\n      // \u9A8C\u8BC1\u6570\u636E\r\n      const validationErrors = validateStreamData(streamData);\r\n      if (validationErrors.length > 0) {\r\n        return errorResponse(\r\n          `Validation errors: ${validationErrors.join(', ')}`,\r\n          'VALIDATION_ERROR',\r\n          400,\r\n          request\r\n        );\r\n      }\r\n\r\n      // \u5982\u679C\u6CA1\u6709\u63D0\u4F9BID\uFF0C\u751F\u6210\u4E00\u4E2A\u968F\u673AID\r\n      if (!streamData.id) {\r\n        streamData.id = `stream_${generateRandomString(8).toLowerCase()}`;\r\n      }\r\n\r\n      try {\r\n        const newStream = await addStreamConfig(env, {\r\n          id: streamData.id,\r\n          name: streamData.name.trim(),\r\n          rtmpUrl: streamData.rtmpUrl.trim()\r\n        });\r\n\r\n        logInfo(env, 'Admin created new stream', {\r\n          username: auth.user.username,\r\n          streamId: newStream.id,\r\n          streamName: newStream.name\r\n        });\r\n\r\n        return successResponse(newStream, 'Stream created successfully', request);\r\n\r\n      } catch (kvError) {\r\n        if (kvError.message.includes('already exists')) {\r\n          return errorResponse(\r\n            `Stream with ID '${streamData.id}' already exists`,\r\n            'STREAM_EXISTS',\r\n            409,\r\n            request\r\n          );\r\n        }\r\n        throw kvError;\r\n      }\r\n\r\n    } catch (error) {\r\n      logError(env, 'Admin create stream handler error', error);\r\n      return errorResponse('Failed to create stream', 'ADMIN_CREATE_ERROR', 500, request);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * \u66F4\u65B0\u6D41\u914D\u7F6E\r\n   */\r\n  async updateStream(request, env, ctx) {\r\n    try {\r\n      const { auth, error } = await requireAdmin(request, env);\r\n      if (error) return error;\r\n\r\n      const { id: streamId } = request.params;\r\n      if (!streamId) {\r\n        return errorResponse('Stream ID is required', 'MISSING_STREAM_ID', 400, request);\r\n      }\r\n\r\n      let updateData;\r\n      try {\r\n        updateData = await request.json();\r\n      } catch (error) {\r\n        return errorResponse('Invalid JSON in request body', 'INVALID_JSON', 400, request);\r\n      }\r\n\r\n      // \u9A8C\u8BC1\u66F4\u65B0\u6570\u636E\r\n      const validationErrors = validateStreamData(updateData, true);\r\n      if (validationErrors.length > 0) {\r\n        return errorResponse(\r\n          `Validation errors: ${validationErrors.join(', ')}`,\r\n          'VALIDATION_ERROR',\r\n          400,\r\n          request\r\n        );\r\n      }\r\n\r\n      try {\r\n        // \u51C6\u5907\u66F4\u65B0\u6570\u636E\uFF08\u79FB\u9664ID\u5B57\u6BB5\uFF0C\u4E0D\u5141\u8BB8\u66F4\u6539\uFF09\r\n        const { id, ...updates } = updateData;\r\n\r\n        // \u6E05\u7406\u6570\u636E\r\n        if (updates.name) updates.name = updates.name.trim();\r\n        if (updates.rtmpUrl) updates.rtmpUrl = updates.rtmpUrl.trim();\r\n\r\n        const updatedStream = await updateStreamConfig(env, streamId, updates);\r\n\r\n        logInfo(env, 'Admin updated stream', {\r\n          username: auth.user.username,\r\n          streamId,\r\n          updates: Object.keys(updates)\r\n        });\r\n\r\n        return successResponse(updatedStream, 'Stream updated successfully', request);\r\n\r\n      } catch (kvError) {\r\n        if (kvError.message.includes('not found')) {\r\n          return errorResponse(\r\n            `Stream with ID '${streamId}' not found`,\r\n            'STREAM_NOT_FOUND',\r\n            404,\r\n            request\r\n          );\r\n        }\r\n        throw kvError;\r\n      }\r\n\r\n    } catch (error) {\r\n      logError(env, 'Admin update stream handler error', error);\r\n      return errorResponse('Failed to update stream', 'ADMIN_UPDATE_ERROR', 500, request);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * \u5220\u9664\u6D41\u914D\u7F6E\r\n   */\r\n  async deleteStream(request, env, ctx) {\r\n    try {\r\n      const { auth, error } = await requireAdmin(request, env);\r\n      if (error) return error;\r\n\r\n      const { id: streamId } = request.params;\r\n      if (!streamId) {\r\n        return errorResponse('Stream ID is required', 'MISSING_STREAM_ID', 400, request);\r\n      }\r\n\r\n      try {\r\n        const deletedStream = await deleteStreamConfig(env, streamId);\r\n\r\n        logInfo(env, 'Admin deleted stream', {\r\n          username: auth.user.username,\r\n          streamId,\r\n          streamName: deletedStream.name\r\n        });\r\n\r\n        return successResponse({\r\n          deleted: deletedStream\r\n        }, 'Stream deleted successfully', request);\r\n\r\n      } catch (kvError) {\r\n        if (kvError.message.includes('not found')) {\r\n          return errorResponse(\r\n            `Stream with ID '${streamId}' not found`,\r\n            'STREAM_NOT_FOUND',\r\n            404,\r\n            request\r\n          );\r\n        }\r\n        throw kvError;\r\n      }\r\n\r\n    } catch (error) {\r\n      logError(env, 'Admin delete stream handler error', error);\r\n      return errorResponse('Failed to delete stream', 'ADMIN_DELETE_ERROR', 500, request);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * \u83B7\u53D6\u7CFB\u7EDF\u72B6\u6001\u4FE1\u606F\r\n   */\r\n  async getSystemStatus(request, env, ctx) {\r\n    try {\r\n      const { auth, error } = await requireAdmin(request, env);\r\n      if (error) return error;\r\n\r\n      // \u83B7\u53D6\u6D41\u914D\u7F6E\u7EDF\u8BA1\r\n      const streamsConfig = await getStreamsConfig(env);\r\n\r\n      // \u83B7\u53D6VPS\u7CFB\u7EDF\u72B6\u6001\r\n      const vpsStatus = await getVpsStatus(env);\r\n\r\n      const systemStatus = {\r\n        cloudflare: {\r\n          worker: {\r\n            timestamp: new Date().toISOString(),\r\n            environment: env.ENVIRONMENT || 'unknown'\r\n          },\r\n          kv: {\r\n            streamsCount: streamsConfig.length,\r\n            available: true // \u5982\u679C\u80FD\u8BFB\u53D6\u5230\u914D\u7F6E\u5C31\u8BF4\u660EKV\u53EF\u7528\r\n          }\r\n        },\r\n        vps: vpsStatus.data || { \r\n          error: vpsStatus.error,\r\n          available: false\r\n        },\r\n        streams: {\r\n          configured: streamsConfig.length,\r\n          configList: streamsConfig.map(s => ({\r\n            id: s.id,\r\n            name: s.name,\r\n            createdAt: s.createdAt,\r\n            updatedAt: s.updatedAt\r\n          }))\r\n        }\r\n      };\r\n\r\n      logInfo(env, 'Admin retrieved system status', {\r\n        username: auth.user.username,\r\n        vpsAvailable: !vpsStatus.error,\r\n        streamsCount: streamsConfig.length\r\n      });\r\n\r\n      return successResponse(systemStatus, 'System status retrieved successfully', request);\r\n\r\n    } catch (error) {\r\n      logError(env, 'Admin get system status handler error', error);\r\n      return errorResponse('Failed to retrieve system status', 'ADMIN_STATUS_ERROR', 500, request);\r\n    }\r\n  },\r\n\r\n  // \u83B7\u53D6\u7F13\u5B58\u7EDF\u8BA1\u4FE1\u606F\r\n  async getCacheStats(request, env, ctx) {\r\n    try {\r\n      console.log('Admin get cache stats request');\r\n      \r\n      // \u9A8C\u8BC1\u7BA1\u7406\u5458\u6743\u9650\r\n      const authResult = await requireAdmin(request, env);\r\n      if (authResult.error) {\r\n        return authResult.error;\r\n      }\r\n\r\n      const cacheStats = getCacheStats();\r\n      \r\n      return successResponse({\r\n        cache: cacheStats,\r\n        timestamp: new Date().toISOString()\r\n      }, 'Cache statistics retrieved successfully', request);\r\n\r\n    } catch (error) {\r\n      console.error('Admin get cache stats error:', error);\r\n      logError(env, 'Admin get cache stats handler error', error);\r\n      return errorResponse('Failed to retrieve cache statistics', 'ADMIN_CACHE_STATS_ERROR', 500, request);\r\n    }\r\n  },\r\n\r\n  // \u6E05\u7406\u7F13\u5B58\r\n  async clearCache(request, env, ctx) {\r\n    try {\r\n      console.log('Admin clear cache request');\r\n      \r\n      // \u9A8C\u8BC1\u7BA1\u7406\u5458\u6743\u9650\r\n      const authResult = await requireAdmin(request, env);\r\n      if (authResult.error) {\r\n        return authResult.error;\r\n      }\r\n\r\n      const clearedCount = clearCache();\r\n      \r\n      return successResponse({\r\n        cleared: true,\r\n        clearedItems: clearedCount,\r\n        timestamp: new Date().toISOString()\r\n      }, 'Cache cleared successfully', request);\r\n\r\n    } catch (error) {\r\n      console.error('Admin clear cache error:', error);\r\n      logError(env, 'Admin clear cache handler error', error);\r\n      return errorResponse('Failed to clear cache', 'ADMIN_CACHE_CLEAR_ERROR', 500, request);\r\n    }\r\n  },\r\n\r\n  // \u91CD\u8F7D\u6D41\u914D\u7F6E\r\n  async reloadStreamsConfig(request, env, ctx) {\r\n    try {\r\n      console.log('Admin reload streams config request');\r\n      \r\n      // \u9A8C\u8BC1\u7BA1\u7406\u5458\u6743\u9650\r\n      const authResult = await requireAdmin(request, env);\r\n      if (authResult.error) {\r\n        return authResult.error;\r\n      }\r\n\r\n      // \u6E05\u7406\u6D41\u76F8\u5173\u7684\u7F13\u5B58\r\n      clearCache('streams:');\r\n      clearCache('stream:');\r\n      \r\n      // \u91CD\u65B0\u52A0\u8F7D\u6D41\u914D\u7F6E\r\n      const streams = await getStreamsConfig(env);\r\n      \r\n      return successResponse({\r\n        reloaded: true,\r\n        streamsCount: streams.length,\r\n        timestamp: new Date().toISOString()\r\n      }, 'Streams configuration reloaded successfully', request);\r\n\r\n    } catch (error) {\r\n      console.error('Admin reload streams config error:', error);\r\n      logError(env, 'Admin reload streams config handler error', error);\r\n      return errorResponse('Failed to reload streams configuration', 'ADMIN_STREAMS_RELOAD_ERROR', 500, request);\r\n    }\r\n  },\r\n\r\n  // \u83B7\u53D6\u7CFB\u7EDF\u8BCA\u65AD\u4FE1\u606F\r\n  async getSystemDiagnostics(request, env, ctx) {\r\n    try {\r\n      console.log('Admin get system diagnostics request');\r\n      const startTime = Date.now();\r\n      \r\n      // \u9A8C\u8BC1\u7BA1\u7406\u5458\u6743\u9650\r\n      const authResult = await requireAdmin(request, env);\r\n      if (authResult.error) {\r\n        return authResult.error;\r\n      }\r\n\r\n      // \u6536\u96C6\u8BCA\u65AD\u4FE1\u606F\r\n      const diagnostics = {\r\n        worker: {\r\n          version: '1.0.0',\r\n          environment: env.ENVIRONMENT || 'development',\r\n          timestamp: new Date().toISOString(),\r\n          uptime: Date.now() - startTime\r\n        },\r\n        kv: {\r\n          available: false,\r\n          namespace: 'YOYO_USER_DB',\r\n          testResult: null\r\n        },\r\n        vps: {\r\n          available: false,\r\n          url: env.VPS_API_URL || 'not configured',\r\n          testResult: null\r\n        },\r\n        cache: getCacheStats(),\r\n        performance: {\r\n          diagnosticsTime: null\r\n        }\r\n      };\r\n\r\n      // \u6D4B\u8BD5KV\u53EF\u7528\u6027\r\n      try {\r\n        await env.YOYO_USER_DB.put('health_check', 'ok', { expirationTtl: 60 });\r\n        const testValue = await env.YOYO_USER_DB.get('health_check');\r\n        diagnostics.kv.available = testValue === 'ok';\r\n        diagnostics.kv.testResult = 'success';\r\n      } catch (kvError) {\r\n        console.error('KV health check failed:', kvError);\r\n        diagnostics.kv.testResult = kvError.message;\r\n      }\r\n\r\n      // \u6D4B\u8BD5VPS\u53EF\u7528\u6027\r\n      if (env.VPS_API_URL) {\r\n        try {\r\n          const vpsResponse = await fetch(`${env.VPS_API_URL}/health`, {\r\n            method: 'GET',\r\n            headers: {\r\n              'Authorization': `Bearer ${env.VPS_API_KEY}`,\r\n              'Content-Type': 'application/json'\r\n            },\r\n            signal: AbortSignal.timeout(5000)\r\n          });\r\n          \r\n          diagnostics.vps.available = vpsResponse.ok;\r\n          diagnostics.vps.testResult = vpsResponse.ok ? 'success' : `HTTP ${vpsResponse.status}`;\r\n        } catch (vpsError) {\r\n          console.error('VPS health check failed:', vpsError);\r\n          diagnostics.vps.testResult = vpsError.message;\r\n        }\r\n      }\r\n\r\n      diagnostics.performance.diagnosticsTime = Date.now() - startTime;\r\n      \r\n      return successResponse(diagnostics, 'System diagnostics completed successfully', request);\r\n\r\n    } catch (error) {\r\n      console.error('Admin get system diagnostics error:', error);\r\n      logError(env, 'Admin get system diagnostics handler error', error);\r\n      return errorResponse('Failed to retrieve system diagnostics', 'ADMIN_DIAGNOSTICS_ERROR', 500, request);\r\n    }\r\n  }\r\n};\r\n", "/**\r\n * HLS\u4EE3\u7406\u5904\u7406\u5668\r\n */\r\n\r\nimport { validateSession } from './auth.js';\r\nimport { getStreamConfig } from '../utils/kv.js';\r\nimport { errorResponse } from '../utils/cors.js';\r\nimport { logError, logInfo } from '../utils/logger.js';\r\n\r\n/**\r\n * \u7F13\u5B58\u63A7\u5236\u5934\u8BBE\u7F6E\r\n */\r\nconst CACHE_HEADERS = {\r\n  m3u8: {\r\n    'Cache-Control': 'no-cache, no-store, must-revalidate',\r\n    'Pragma': 'no-cache',\r\n    'Expires': '0'\r\n  },\r\n  ts: {\r\n    'Cache-Control': 'public, max-age=3600',\r\n    'Expires': new Date(Date.now() + 3600000).toUTCString()\r\n  }\r\n};\r\n\r\nexport const handleProxy = {\r\n  /**\r\n   * \u4EE3\u7406HLS\u6587\u4EF6\u8BF7\u6C42\u5230VPS\u670D\u52A1\u5668\r\n   */\r\n  async hlsFile(request, env, ctx) {\r\n    try {\r\n      const startTime = Date.now();\r\n\r\n      // \u9A8C\u8BC1\u7528\u6237\u8BA4\u8BC1\r\n      const auth = await validateSession(request, env);\r\n      if (!auth) {\r\n        return errorResponse('Authentication required to access streams', 'AUTH_REQUIRED', 401, request);\r\n      }\r\n\r\n      const { streamId, file } = request.params;\r\n\r\n      if (!streamId || !file) {\r\n        return errorResponse('Stream ID and file name are required', 'MISSING_PARAMS', 400, request);\r\n      }\r\n\r\n      // \u9A8C\u8BC1\u6D41\u662F\u5426\u5B58\u5728\u4E8E\u914D\u7F6E\u4E2D\r\n      const streamConfig = await getStreamConfig(env, streamId);\r\n      if (!streamConfig) {\r\n        return errorResponse(`Stream '${streamId}' not found`, 'STREAM_NOT_FOUND', 404, request);\r\n      }\r\n\r\n      // \u9A8C\u8BC1\u6587\u4EF6\u7C7B\u578B\uFF08\u5B89\u5168\u68C0\u67E5\uFF09\r\n      const fileExtension = file.split('.').pop()?.toLowerCase();\r\n      if (!['m3u8', 'ts'].includes(fileExtension)) {\r\n        return errorResponse('Invalid file type', 'INVALID_FILE_TYPE', 400, request);\r\n      }\r\n\r\n      // \u6784\u5EFAVPS\u4E0A\u7684HLS\u6587\u4EF6URL\r\n      const vpsBaseUrl = env.VPS_HLS_URL || `http://${env.VPS_IP || 'your-vps-ip'}:8080`;\r\n      const hlsFileUrl = `${vpsBaseUrl}/hls/${streamId}/${file}`;\r\n\r\n      try {\r\n        // \u4EE3\u7406\u8BF7\u6C42\u5230VPS\r\n        const vpsResponse = await fetch(hlsFileUrl, {\r\n          method: request.method,\r\n          headers: {\r\n            'User-Agent': 'Cloudflare-Worker-HLS-Proxy/1.0',\r\n            'Accept': request.headers.get('Accept') || '*/*',\r\n            'Accept-Encoding': request.headers.get('Accept-Encoding') || 'gzip, deflate',\r\n            'Range': request.headers.get('Range') // \u652F\u6301Range\u8BF7\u6C42\r\n          },\r\n          // \u8BBE\u7F6E\u8D85\u65F6\r\n          signal: AbortSignal.timeout(10000) // 10\u79D2\u8D85\u65F6\r\n        });\r\n\r\n        if (!vpsResponse.ok) {\r\n          // \u5982\u679C\u662F404\uFF0C\u53EF\u80FD\u662F\u6587\u4EF6\u8FD8\u6CA1\u751F\u6210\uFF0C\u8FD4\u56DE\u66F4\u53CB\u597D\u7684\u9519\u8BEF\r\n          if (vpsResponse.status === 404) {\r\n            return new Response('Stream file not available yet. Please try again in a moment.', {\r\n              status: 202, // 202 Accepted - \u8868\u793A\u6B63\u5728\u5904\u7406\r\n              headers: {\r\n                'Content-Type': 'text/plain',\r\n                'Retry-After': '2' // \u5EFA\u8BAE2\u79D2\u540E\u91CD\u8BD5\r\n              }\r\n            });\r\n          }\r\n\r\n          return new Response(`Upstream server error: ${vpsResponse.status}`, {\r\n            status: vpsResponse.status,\r\n            headers: {\r\n              'Content-Type': 'text/plain'\r\n            }\r\n          });\r\n        }\r\n\r\n        // \u83B7\u53D6\u54CD\u5E94\u5185\u5BB9\r\n        const responseBody = await vpsResponse.arrayBuffer();\r\n\r\n        // \u51C6\u5907\u54CD\u5E94\u5934\r\n        const responseHeaders = {\r\n          'Content-Type': vpsResponse.headers.get('Content-Type') || \r\n                          (fileExtension === 'm3u8' ? 'application/vnd.apple.mpegurl' : 'video/mp2t'),\r\n          'Content-Length': vpsResponse.headers.get('Content-Length'),\r\n          'Last-Modified': vpsResponse.headers.get('Last-Modified'),\r\n          'ETag': vpsResponse.headers.get('ETag'),\r\n          'Access-Control-Allow-Origin': '*',\r\n          'Access-Control-Allow-Methods': 'GET, OPTIONS',\r\n          'Access-Control-Allow-Headers': 'Range, Accept-Encoding',\r\n          'Access-Control-Expose-Headers': 'Accept-Ranges, Content-Encoding, Content-Length, Content-Range',\r\n          // \u6839\u636E\u6587\u4EF6\u7C7B\u578B\u8BBE\u7F6E\u7F13\u5B58\u7B56\u7565\r\n          ...CACHE_HEADERS[fileExtension]\r\n        };\r\n\r\n        // \u79FB\u9664\u7A7A\u503C\r\n        Object.keys(responseHeaders).forEach(key => {\r\n          if (responseHeaders[key] === null || responseHeaders[key] === undefined) {\r\n            delete responseHeaders[key];\r\n          }\r\n        });\r\n\r\n        // \u652F\u6301Range\u8BF7\u6C42\uFF08\u5BF9\u4E8E.ts\u6587\u4EF6\uFF09\r\n        if (request.headers.get('Range') && vpsResponse.headers.get('Content-Range')) {\r\n          responseHeaders['Content-Range'] = vpsResponse.headers.get('Content-Range');\r\n          responseHeaders['Accept-Ranges'] = 'bytes';\r\n        }\r\n\r\n        const responseTime = Date.now() - startTime;\r\n\r\n        // \u8BB0\u5F55\u6210\u529F\u7684\u4EE3\u7406\u8BF7\u6C42\uFF08\u4EC5\u5BF9m3u8\u6587\u4EF6\uFF0C\u51CF\u5C11\u65E5\u5FD7\u91CF\uFF09\r\n        if (fileExtension === 'm3u8') {\r\n          logInfo(env, 'HLS file proxied successfully', {\r\n            streamId,\r\n            file,\r\n            username: auth.user.username,\r\n            responseTime: `${responseTime}ms`,\r\n            fileSize: responseBody.byteLength,\r\n            clientIp: request.headers.get('CF-Connecting-IP')\r\n          });\r\n        }\r\n\r\n        return new Response(responseBody, {\r\n          status: vpsResponse.status,\r\n          headers: responseHeaders\r\n        });\r\n\r\n      } catch (fetchError) {\r\n        logError(env, 'HLS file proxy fetch error', fetchError, {\r\n          streamId,\r\n          file,\r\n          username: auth.user.username,\r\n          hlsFileUrl,\r\n          responseTime: Date.now() - startTime\r\n        });\r\n\r\n        if (fetchError.name === 'TimeoutError') {\r\n          return new Response('Stream server timeout. Please try again.', {\r\n            status: 504,\r\n            headers: {\r\n              'Content-Type': 'text/plain',\r\n              'Retry-After': '5'\r\n            }\r\n          });\r\n        }\r\n\r\n        return new Response('Failed to fetch stream data from server', {\r\n          status: 502,\r\n          headers: {\r\n            'Content-Type': 'text/plain'\r\n          }\r\n        });\r\n      }\r\n\r\n    } catch (error) {\r\n      logError(env, 'HLS proxy handler error', error, {\r\n        streamId: request.params?.streamId,\r\n        file: request.params?.file,\r\n        url: request.url\r\n      });\r\n\r\n      return errorResponse('Internal server error during stream proxy', 'PROXY_ERROR', 500, request);\r\n    }\r\n  }\r\n};\r\n", "/**\r\n * \u9875\u9762\u5904\u7406\u5668 - \u63D0\u4F9B\u524D\u7AEFHTML\u9875\u9762\r\n */\r\n\r\nimport { validateSession } from './auth.js';\r\n\r\n/**\r\n * \u57FA\u7840HTML\u6A21\u677F\r\n */\r\nconst HTML_TEMPLATE = `\r\n<!DOCTYPE html>\r\n<html lang=\"zh-CN\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>{{TITLE}} - YOYO\u6D41\u5A92\u4F53\u5E73\u53F0</title>\r\n    <link rel=\"icon\" type=\"image/x-icon\" href=\"/static/favicon.ico\">\r\n    <style>\r\n        * {\r\n            margin: 0;\r\n            padding: 0;\r\n            box-sizing: border-box;\r\n        }\r\n\r\n        body {\r\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n            min-height: 100vh;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n        }\r\n\r\n        .container {\r\n            background: rgba(255, 255, 255, 0.95);\r\n            backdrop-filter: blur(10px);\r\n            padding: 2rem;\r\n            border-radius: 16px;\r\n            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\r\n            max-width: 400px;\r\n            width: 90%;\r\n            text-align: center;\r\n        }\r\n\r\n        .logo {\r\n            font-size: 2rem;\r\n            font-weight: bold;\r\n            color: #667eea;\r\n            margin-bottom: 0.5rem;\r\n        }\r\n\r\n        .subtitle {\r\n            color: #666;\r\n            margin-bottom: 2rem;\r\n            font-size: 0.9rem;\r\n        }\r\n\r\n        .loading {\r\n            display: inline-block;\r\n            width: 20px;\r\n            height: 20px;\r\n            border: 2px solid #f3f3f3;\r\n            border-top: 2px solid #667eea;\r\n            border-radius: 50%;\r\n            animation: spin 1s linear infinite;\r\n        }\r\n\r\n        @keyframes spin {\r\n            0% { transform: rotate(0deg); }\r\n            100% { transform: rotate(360deg); }\r\n        }\r\n\r\n        .message {\r\n            color: #666;\r\n            margin-top: 1rem;\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"container\">\r\n        <div class=\"logo\">YOYO</div>\r\n        <div class=\"subtitle\">\u5B89\u5168\u6D41\u5A92\u4F53\u64AD\u653E\u5E73\u53F0</div>\r\n        {{CONTENT}}\r\n    </div>\r\n\r\n    <script>\r\n        {{SCRIPT}}\r\n    </script>\r\n</body>\r\n</html>\r\n`;\r\n\r\n/**\r\n * \u767B\u5F55\u9875\u9762\u5185\u5BB9\r\n */\r\nconst LOGIN_CONTENT = `\r\n    <div id=\"login-form\">\r\n        <form onsubmit=\"handleLogin(event)\">\r\n            <div style=\"margin-bottom: 1rem;\">\r\n                <input type=\"text\" id=\"username\" placeholder=\"\u7528\u6237\u540D\" required \r\n                       style=\"width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;\">\r\n            </div>\r\n            <div style=\"margin-bottom: 1.5rem;\">\r\n                <input type=\"password\" id=\"password\" placeholder=\"\u5BC6\u7801\" required \r\n                       style=\"width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;\">\r\n            </div>\r\n            <button type=\"submit\" id=\"login-btn\"\r\n                    style=\"width: 100%; padding: 0.75rem; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease;\">\r\n                \u767B\u5F55\r\n            </button>\r\n        </form>\r\n        <div id=\"error-message\" style=\"color: #e74c3c; margin-top: 1rem; display: none;\"></div>\r\n    </div>\r\n`;\r\n\r\n/**\r\n * \u767B\u5F55\u9875\u9762\u811A\u672C\r\n */\r\nconst LOGIN_SCRIPT = `\r\n    async function handleLogin(event) {\r\n        event.preventDefault();\r\n\r\n        const username = document.getElementById('username').value;\r\n        const password = document.getElementById('password').value;\r\n        const loginBtn = document.getElementById('login-btn');\r\n        const errorDiv = document.getElementById('error-message');\r\n\r\n        // \u663E\u793A\u52A0\u8F7D\u72B6\u6001\r\n        loginBtn.innerHTML = '<div class=\"loading\"></div>';\r\n        loginBtn.disabled = true;\r\n        errorDiv.style.display = 'none';\r\n\r\n        try {\r\n            const response = await fetch('/login', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({ username, password }),\r\n                credentials: 'include'\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (response.ok) {\r\n                // \u767B\u5F55\u6210\u529F\uFF0C\u8DF3\u8F6C\u5230\u4E3B\u9875\r\n                window.location.href = '/';\r\n            } else {\r\n                // \u663E\u793A\u9519\u8BEF\u4FE1\u606F\r\n                errorDiv.textContent = data.message || '\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5';\r\n                errorDiv.style.display = 'block';\r\n            }\r\n        } catch (error) {\r\n            errorDiv.textContent = '\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u8FDE\u63A5';\r\n            errorDiv.style.display = 'block';\r\n        }\r\n\r\n        // \u6062\u590D\u6309\u94AE\u72B6\u6001\r\n        loginBtn.innerHTML = '\u767B\u5F55';\r\n        loginBtn.disabled = false;\r\n    }\r\n\r\n    // \u56DE\u8F66\u952E\u63D0\u4EA4\r\n    document.addEventListener('keypress', function(event) {\r\n        if (event.key === 'Enter') {\r\n            event.preventDefault();\r\n            document.querySelector('form').dispatchEvent(new Event('submit'));\r\n        }\r\n    });\r\n`;\r\n\r\n/**\r\n * \u52A0\u8F7D\u4E2D\u9875\u9762\u5185\u5BB9\r\n */\r\nconst LOADING_CONTENT = `\r\n    <div class=\"loading\" style=\"margin: 0 auto 1rem;\"></div>\r\n    <div class=\"message\">\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019...</div>\r\n`;\r\n\r\n/**\r\n * \u91CD\u5B9A\u5411\u811A\u672C\r\n */\r\nconst REDIRECT_SCRIPT = `\r\n    // \u68C0\u67E5\u8BA4\u8BC1\u72B6\u6001\u5E76\u91CD\u5B9A\u5411\r\n    async function checkAuthAndRedirect() {\r\n        try {\r\n            const response = await fetch('/api/me', {\r\n                credentials: 'include'\r\n            });\r\n\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                const user = data.data.user;\r\n\r\n                // \u6839\u636E\u7528\u6237\u89D2\u8272\u8DF3\u8F6C\u5230\u4E0D\u540C\u9875\u9762\r\n                if (user.role === 'admin') {\r\n                    window.location.href = '/admin';\r\n                } else {\r\n                    // \u8FD9\u91CC\u5E94\u8BE5\u8DF3\u8F6C\u5230\u5B9E\u9645\u7684\u524D\u7AEF\u5E94\u7528\r\n                    window.location.href = 'https://your-frontend-domain.com';\r\n                }\r\n            } else {\r\n                // \u672A\u8BA4\u8BC1\uFF0C\u8DF3\u8F6C\u5230\u767B\u5F55\u9875\r\n                window.location.href = '/login';\r\n            }\r\n        } catch (error) {\r\n            console.error('Auth check failed:', error);\r\n            window.location.href = '/login';\r\n        }\r\n    }\r\n\r\n    // \u9875\u9762\u52A0\u8F7D\u540E\u68C0\u67E5\u8BA4\u8BC1\r\n    checkAuthAndRedirect();\r\n`;\r\n\r\n/**\r\n * \u7BA1\u7406\u5458\u9875\u9762\u5185\u5BB9\r\n */\r\nconst ADMIN_CONTENT = `\r\n    <div>\r\n        <h2 style=\"color: #333; margin-bottom: 1rem;\">\u7BA1\u7406\u5458\u63A7\u5236\u53F0</h2>\r\n        <div class=\"loading\" style=\"margin: 0 auto 1rem;\"></div>\r\n        <div class=\"message\">\u6B63\u5728\u52A0\u8F7D\u7BA1\u7406\u754C\u9762...</div>\r\n        <div style=\"margin-top: 2rem;\">\r\n            <button onclick=\"logout()\" style=\"padding: 0.5rem 1rem; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;\">\r\n                \u9000\u51FA\u767B\u5F55\r\n            </button>\r\n        </div>\r\n    </div>\r\n`;\r\n\r\n/**\r\n * \u7BA1\u7406\u5458\u9875\u9762\u811A\u672C\r\n */\r\nconst ADMIN_SCRIPT = `\r\n    async function logout() {\r\n        try {\r\n            await fetch('/logout', {\r\n                method: 'POST',\r\n                credentials: 'include'\r\n            });\r\n            window.location.href = '/login';\r\n        } catch (error) {\r\n            console.error('Logout failed:', error);\r\n        }\r\n    }\r\n\r\n    // \u8FD9\u91CC\u5E94\u8BE5\u52A0\u8F7D\u5B9E\u9645\u7684\u7BA1\u7406\u754C\u9762\r\n    setTimeout(() => {\r\n        document.querySelector('.container').innerHTML = \\`\r\n            <div class=\"logo\">YOYO</div>\r\n            <div class=\"subtitle\">\u7BA1\u7406\u5458\u63A7\u5236\u53F0</div>\r\n            <div style=\"text-align: left; margin: 2rem 0;\">\r\n                <h3 style=\"color: #333; margin-bottom: 1rem;\">\u5FEB\u901F\u94FE\u63A5</h3>\r\n                <div style=\"display: grid; gap: 0.5rem;\">\r\n                    <a href=\"https://your-admin-frontend.com\" target=\"_blank\" \r\n                       style=\"padding: 0.75rem; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; text-decoration: none; color: #495057; display: block;\">\r\n                        \uD83D\uDCCA \u6D41\u5A92\u4F53\u7BA1\u7406\u754C\u9762\r\n                    </a>\r\n                    <a href=\"/api/admin/status\" target=\"_blank\"\r\n                       style=\"padding: 0.75rem; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; text-decoration: none; color: #495057; display: block;\">\r\n                        \uD83D\uDD27 \u7CFB\u7EDF\u72B6\u6001 API\r\n                    </a>\r\n                </div>\r\n            </div>\r\n            <button onclick=\"logout()\" style=\"width: 100%; padding: 0.75rem; background: #e74c3c; color: white; border: none; border-radius: 8px; cursor: pointer;\">\r\n                \u9000\u51FA\u767B\u5F55\r\n            </button>\r\n        \\`;\r\n    }, 2000);\r\n`;\r\n\r\nexport const handlePages = {\r\n  /**\r\n   * \u4E3B\u9875\u9762 - \u6839\u636E\u8BA4\u8BC1\u72B6\u6001\u91CD\u5B9A\u5411\r\n   */\r\n  async dashboard(request, env, ctx) {\r\n    return new Response(\r\n      HTML_TEMPLATE\r\n        .replace('{{TITLE}}', '\u9996\u9875')\r\n        .replace('{{CONTENT}}', LOADING_CONTENT)\r\n        .replace('{{SCRIPT}}', REDIRECT_SCRIPT),\r\n      {\r\n        headers: {\r\n          'Content-Type': 'text/html; charset=utf-8',\r\n          'Cache-Control': 'no-cache, no-store, must-revalidate'\r\n        }\r\n      }\r\n    );\r\n  },\r\n\r\n  /**\r\n   * \u767B\u5F55\u9875\u9762\r\n   */\r\n  async login(request, env, ctx) {\r\n    // \u5982\u679C\u7528\u6237\u5DF2\u7ECF\u767B\u5F55\uFF0C\u91CD\u5B9A\u5411\u5230\u4E3B\u9875\r\n    const auth = await validateSession(request, env);\r\n    if (auth) {\r\n      return Response.redirect(new URL('/', request.url).toString(), 302);\r\n    }\r\n\r\n    return new Response(\r\n      HTML_TEMPLATE\r\n        .replace('{{TITLE}}', '\u767B\u5F55')\r\n        .replace('{{CONTENT}}', LOGIN_CONTENT)\r\n        .replace('{{SCRIPT}}', LOGIN_SCRIPT),\r\n      {\r\n        headers: {\r\n          'Content-Type': 'text/html; charset=utf-8',\r\n          'Cache-Control': 'no-cache, no-store, must-revalidate'\r\n        }\r\n      }\r\n    );\r\n  },\r\n\r\n  /**\r\n   * \u7BA1\u7406\u5458\u9875\u9762\r\n   */\r\n  async admin(request, env, ctx) {\r\n    const auth = await validateSession(request, env);\r\n\r\n    if (!auth) {\r\n      return Response.redirect(new URL('/login', request.url).toString(), 302);\r\n    }\r\n\r\n    if (auth.user.role !== 'admin') {\r\n      return new Response(\r\n        HTML_TEMPLATE\r\n          .replace('{{TITLE}}', '\u8BBF\u95EE\u62D2\u7EDD')\r\n          .replace('{{CONTENT}}', '<div style=\"color: #e74c3c;\">\u26A0\uFE0F \u8BBF\u95EE\u88AB\u62D2\u7EDD\uFF1A\u9700\u8981\u7BA1\u7406\u5458\u6743\u9650</div>')\r\n          .replace('{{SCRIPT}}', ''),\r\n        {\r\n          status: 403,\r\n          headers: {\r\n            'Content-Type': 'text/html; charset=utf-8'\r\n          }\r\n        }\r\n      );\r\n    }\r\n\r\n    return new Response(\r\n      HTML_TEMPLATE\r\n        .replace('{{TITLE}}', '\u7BA1\u7406\u5458\u63A7\u5236\u53F0')\r\n        .replace('{{CONTENT}}', ADMIN_CONTENT)\r\n        .replace('{{SCRIPT}}', ADMIN_SCRIPT),\r\n      {\r\n        headers: {\r\n          'Content-Type': 'text/html; charset=utf-8',\r\n          'Cache-Control': 'no-cache, no-store, must-revalidate'\r\n        }\r\n      }\r\n    );\r\n  },\r\n\r\n  /**\r\n   * \u9759\u6001\u8D44\u6E90\u5904\u7406\uFF08\u5982\u679C\u9700\u8981\uFF09\r\n   */\r\n  async static(request, env, ctx) {\r\n    const url = new URL(request.url);\r\n    const pathname = url.pathname;\r\n\r\n    // \u7B80\u5355\u7684\u9759\u6001\u6587\u4EF6\u670D\u52A1\uFF08\u5728\u5B9E\u9645\u9879\u76EE\u4E2D\u5E94\u8BE5\u4F7F\u7528CDN\uFF09\r\n    if (pathname.endsWith('favicon.ico')) {\r\n      // \u8FD4\u56DE\u4E00\u4E2A\u7B80\u5355\u7684favicon\r\n      const faviconSvg = `\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\r\n          <rect width=\"32\" height=\"32\" rx=\"6\" fill=\"#667eea\"/>\r\n          <text x=\"16\" y=\"22\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"14\" font-weight=\"bold\" fill=\"white\">Y</text>\r\n        </svg>\r\n      `;\r\n\r\n      return new Response(faviconSvg, {\r\n        headers: {\r\n          'Content-Type': 'image/svg+xml',\r\n          'Cache-Control': 'public, max-age=86400'\r\n        }\r\n      });\r\n    }\r\n\r\n    return new Response('Static file not found', { status: 404 });\r\n  }\r\n};\r\n", "/**\r\n * YOYO\u6D41\u5A92\u4F53\u5E73\u53F0 - Cloudflare Worker\r\n * \u4E3B\u5165\u53E3\u6587\u4EF6\r\n */\r\n\r\nimport { Router } from './router';\r\nimport { handleOptions } from './utils/cors';\r\nimport { logError } from './utils/logger';\r\n\r\n// \u5BFC\u5165\u8DEF\u7531\u5904\u7406\u5668\r\nimport { handleAuth } from './handlers/auth';\r\nimport { handleStreams } from './handlers/streams';\r\nimport { handleAdmin } from './handlers/admin';\r\nimport { handleProxy } from './handlers/proxy';\r\nimport { handlePages } from './handlers/pages';\r\n\r\nexport default {\r\n  async fetch(request, env, ctx) {\r\n    try {\r\n      // \u521B\u5EFA\u8DEF\u7531\u5668\u5B9E\u4F8B\r\n      const router = new Router();\r\n\r\n      // \u5904\u7406CORS\u9884\u68C0\u8BF7\u6C42\r\n      if (request.method === 'OPTIONS') {\r\n        return handleOptions(request);\r\n      }\r\n\r\n      // \u6CE8\u518C\u8DEF\u7531\u5904\u7406\u5668\r\n\r\n      // \u9875\u9762\u8DEF\u7531\uFF08\u9759\u6001\u9875\u9762\uFF09\r\n      router.get('/', (req, env, ctx) => handlePages.dashboard(req, env, ctx));\r\n      router.get('/login', (req, env, ctx) => handlePages.login(req, env, ctx));\r\n      router.get('/admin', (req, env, ctx) => handlePages.admin(req, env, ctx));\r\n\r\n      // \u8BA4\u8BC1\u76F8\u5173API\r\n      router.post('/login', (req, env, ctx) => handleAuth.login(req, env, ctx));\r\n      router.post('/logout', (req, env, ctx) => handleAuth.logout(req, env, ctx));\r\n      router.get('/api/me', (req, env, ctx) => handleAuth.getCurrentUser(req, env, ctx));\r\n\r\n      // \u7CFB\u7EDF\u72B6\u6001API\uFF08\u901A\u7528\uFF09\r\n      router.get('/api/status', (req, env, ctx) => {\r\n        return new Response(\r\n          JSON.stringify({\r\n            status: 'ok',\r\n            message: 'YOYO Streaming Platform API is running',\r\n            timestamp: new Date().toISOString(),\r\n            version: '1.0.0'\r\n          }),\r\n          {\r\n            status: 200,\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n              'Access-Control-Allow-Origin': '*'\r\n            }\r\n          }\r\n        );\r\n      });\r\n\r\n      // \u7528\u6237\u529F\u80FDAPI\r\n      router.get('/api/streams', (req, env, ctx) => handleStreams.getStreams(req, env, ctx));\r\n      router.post('/api/play/:id', (req, env, ctx) => handleStreams.playStream(req, env, ctx));\r\n      router.post('/api/stop/:id', (req, env, ctx) => handleStreams.stopStream(req, env, ctx));\r\n      router.get('/api/stream/:id/status', (req, env, ctx) => handleStreams.getStreamStatus(req, env, ctx));\r\n      router.get('/api/streams/status', (req, env, ctx) => handleStreams.getAllStreamsStatus(req, env, ctx));\r\n\r\n      // \u7BA1\u7406\u5458\u529F\u80FDAPI\r\n      router.get('/api/admin/streams', (req, env, ctx) => handleAdmin.getStreams(req, env, ctx));\r\n      router.post('/api/admin/streams', (req, env, ctx) => handleAdmin.createStream(req, env, ctx));\r\n      router.put('/api/admin/streams/:id', (req, env, ctx) => handleAdmin.updateStream(req, env, ctx));\r\n      router.delete('/api/admin/streams/:id', (req, env, ctx) => handleAdmin.deleteStream(req, env, ctx));\r\n      router.get('/api/admin/status', (req, env, ctx) => handleAdmin.getSystemStatus(req, env, ctx));\r\n      router.get('/api/admin/cache/stats', (req, env, ctx) => handleAdmin.getCacheStats(req, env, ctx));\r\n      router.post('/api/admin/cache/clear', (req, env, ctx) => handleAdmin.clearCache(req, env, ctx));\r\n      router.post('/api/admin/streams/reload', (req, env, ctx) => handleAdmin.reloadStreamsConfig(req, env, ctx));\r\n      router.get('/api/admin/diagnostics', (req, env, ctx) => handleAdmin.getSystemDiagnostics(req, env, ctx));\r\n\r\n      // HLS\u4EE3\u7406\u8DEF\u7531\r\n      router.get('/hls/:streamId/:file', (req, env, ctx) => handleProxy.hlsFile(req, env, ctx));\r\n\r\n      // \u9759\u6001\u8D44\u6E90\u8DEF\u7531\uFF08\u7528\u4E8E\u524D\u7AEF\u8D44\u6E90\uFF09\r\n      router.get('/static/*', (req, env, ctx) => handlePages.static(req, env, ctx));\r\n\r\n      // \u5904\u7406\u8BF7\u6C42\r\n      const response = await router.handle(request, env, ctx);\r\n\r\n      if (response) {\r\n        return response;\r\n      }\r\n\r\n      // 404\u5904\u7406\r\n      return new Response(\r\n        JSON.stringify({\r\n          status: 'error',\r\n          message: 'Endpoint not found',\r\n          path: new URL(request.url).pathname\r\n        }),\r\n        {\r\n          status: 404,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*'\r\n          }\r\n        }\r\n      );\r\n\r\n    } catch (error) {\r\n      // \u5168\u5C40\u9519\u8BEF\u5904\u7406\r\n      await logError(env, 'Global error handler', error, {\r\n        url: request.url,\r\n        method: request.method,\r\n        userAgent: request.headers.get('User-Agent'),\r\n        cfRay: request.headers.get('CF-Ray'),\r\n        cfConnectingIp: request.headers.get('CF-Connecting-IP')\r\n      });\r\n\r\n      return new Response(\r\n        JSON.stringify({\r\n          status: 'error',\r\n          message: 'Internal server error',\r\n          code: 'INTERNAL_ERROR',\r\n          timestamp: new Date().toISOString()\r\n        }),\r\n        {\r\n          status: 500,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*'\r\n          }\r\n        }\r\n      );\r\n    }\r\n  },\r\n\r\n  // \u5B9A\u65F6\u4EFB\u52A1\u5904\u7406\u5668\uFF08\u53EF\u9009\uFF09\r\n  async scheduled(controller, env, ctx) {\r\n    try {\r\n      // \u6E05\u7406\u8FC7\u671F\u4F1A\u8BDD\r\n      console.log('Running scheduled task: cleanup expired sessions');\r\n      // \u5B9E\u73B0\u4F1A\u8BDD\u6E05\u7406\u903B\u8F91\r\n\r\n    } catch (error) {\r\n      await logError(env, 'Scheduled task error', error);\r\n    }\r\n  }\r\n};\r\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"D:\\\\\u9879\u76EE\u6587\u4EF6\\\\yoyo-kindergarten\\\\code\\\\secure-streaming-platform\\\\vps-transcoder-api\\\\cloudflare-worker\\\\src\\\\index.js\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"D:\\\\Program Files\\\\nodejs\\\\node_global\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"D:\\\\Program Files\\\\nodejs\\\\node_global\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"D:\\\\\u9879\u76EE\u6587\u4EF6\\\\yoyo-kindergarten\\\\code\\\\secure-streaming-platform\\\\vps-transcoder-api\\\\cloudflare-worker\\\\src\\\\index.js\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"D:\\\\\u9879\u76EE\u6587\u4EF6\\\\yoyo-kindergarten\\\\code\\\\secure-streaming-platform\\\\vps-transcoder-api\\\\cloudflare-worker\\\\.wrangler\\\\tmp\\\\bundle-eqpmp8\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"D:\\\\Program Files\\\\nodejs\\\\node_global\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"D:\\\\\u9879\u76EE\u6587\u4EF6\\\\yoyo-kindergarten\\\\code\\\\secure-streaming-platform\\\\vps-transcoder-api\\\\cloudflare-worker\\\\.wrangler\\\\tmp\\\\bundle-eqpmp8\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"D:\\\\\u9879\u76EE\u6587\u4EF6\\\\yoyo-kindergarten\\\\code\\\\secure-streaming-platform\\\\vps-transcoder-api\\\\cloudflare-worker\\\\.wrangler\\\\tmp\\\\bundle-eqpmp8\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": ["error", "env", "ctx"]
}
